<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Programming is Fun | Still waters run deep. When the well&#39;s dry, we know the worth of water.</title>

  
  <meta name="author" content="ykyoon">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Programming is Fun"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Programming is Fun" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Programming is Fun</a>
    </h1>
    <p class="site-description">Still waters run deep. When the well&#39;s dry, we know the worth of water.</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/05/05-05-sample-app/"><span>05-05.SampleApplication(5)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/05/05-05-sample-app/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-05T00:06:39.000Z">
          2018-02-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-5-using-SpringDao"><a href="#SampleApplication-5-using-SpringDao" class="headerlink" title="SampleApplication(5) - using SpringDao"></a>SampleApplication(5) - using SpringDao</h1><p>지금까지 우리는 Template-callback 구조의 SqlExecutor와 Connection을 처리하는 ConnectionFactory를 이용한 Dao 객체들을 구성하였습니다. 지금까지 만든 Dao 객체들을 Spring에서 제공하는 Jdbc객체들을 이용해서 변환시키는 과정을 한번 알아보도록 하겠습니다.</p>
<h2 id="Spring-JDBC를-이용한-DAO의-개발"><a href="#Spring-JDBC를-이용한-DAO의-개발" class="headerlink" title="Spring JDBC를 이용한 DAO의 개발"></a>Spring JDBC를 이용한 DAO의 개발</h2><p>Spring JDBC는 지금까지 이야기한 모든 기능들이 다 포함되어있습니다.</p>
<ul>
<li>Template, callback 구조</li>
<li>DataSource를 이용한 ConnectionFactory 구현</li>
<li>Checked Exception을 Runtime Exception으로 변경</li>
</ul>
<p>먼저, <code>build.gradle</code>에 다음 dependency를 추가합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">group:</span> <span class="string">'org.springframework'</span>, <span class="string">name:</span> <span class="string">'spring-jdbc'</span>, <span class="string">version:</span> <span class="string">'5.0.2.RELEASE'</span></span><br></pre></td></tr></table></figure>
<h3 id="ConnectionFactory-gt-DataSource"><a href="#ConnectionFactory-gt-DataSource" class="headerlink" title="ConnectionFactory -&gt; DataSource"></a>ConnectionFactory -&gt; DataSource</h3><p>ConnectionFactory를 대신할 객체로 Spring에서는 <code>DataSource</code> 인터페이스를 구현한 <code>DriverManagerDataSource</code>를 제공합니다. <code>@Configuration</code>에서 다음과 같이 정의할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">    dataSource.setDriverClassName(<span class="string">"org.mariadb.jdbc.Driver"</span>);</span><br><span class="line">    dataSource.setUrl(<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>);</span><br><span class="line">    dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">"qwer12#$"</span>);</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SqlExecutor-gt-JdbcTemplate"><a href="#SqlExecutor-gt-JdbcTemplate" class="headerlink" title="SqlExecutor -&gt; JdbcTemplate"></a>SqlExecutor -&gt; JdbcTemplate</h3><p>구현된 <code>SqlExecutor</code>에서 제공되는 Template, Callback을 이용한 객체를 <code>Spring</code>에서는 <code>JdbcTemplate</code>로 제공하고 있습니다. 객체 Bean은 다음과 같이 등록이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>JdbcTemplate</code>은 다음 method들을 가지고 있습니다.</p>
<ul>
<li>queryForList: select에 의해서 List return이 발생할 때 사용됩니다.</li>
<li>queryForObject: 한개의 객체를 return하는 method입니다.</li>
<li>update: insert/update/delete query에서 사용됩니다. return값은 영향 받는 row의 갯수를 반환합니다.</li>
</ul>
<p>기존 코드를 이제 <code>JdbcTemplate</code>를 이용해서 모두 변경해보도록 하겠습니다. 기존 <code>BookDao</code>는 다음과 같이 변경이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">countAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select count(*) from books"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, Integer.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"delete from books"</span>;</span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, status, rentUserId, comment, publishDate from books"</span>;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; map : maps) &#123;</span><br><span class="line">            books.add(convertBookFromResultSet(map));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, publishDate, comment, status, rentUserId from books where id=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> Object[] &#123;id&#125;, (rs, rowNum) -&gt; convertBookFromResultSet(rs));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? "</span> +</span><br><span class="line">            <span class="string">"where id = ?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(sql,</span><br><span class="line">            book.getName(), book.getAuthor(),</span><br><span class="line">            <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()),</span><br><span class="line">            book.getComment(),</span><br><span class="line">            book.getBookStatus().value(),</span><br><span class="line">            book.getRentUserId(),</span><br><span class="line">            book.getId()) == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(sql,</span><br><span class="line">            book.getName(), book.getAuthor(),</span><br><span class="line">            <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()),</span><br><span class="line">            book.getComment(),</span><br><span class="line">            book.getBookStatus().value(),</span><br><span class="line">            book.getRentUserId()) == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">"delete from books where id = ?"</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(sql, entity.getId()) == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Book <span class="title">convertBookFromResultSet</span><span class="params">(Map rs)</span> </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId((<span class="keyword">int</span>) rs.get(<span class="string">"id"</span>));</span><br><span class="line">        book.setName((String) rs.get(<span class="string">"name"</span>));</span><br><span class="line">        book.setAuthor((String) rs.get(<span class="string">"author"</span>));</span><br><span class="line">        book.setPublishDate((Timestamp) rs.get(<span class="string">"publishDate"</span>));</span><br><span class="line">        book.setBookStatus(BookStatus.parse((<span class="keyword">int</span>) rs.get(<span class="string">"status"</span>)));</span><br><span class="line">        Integer rentUserId = (Integer) rs.get(<span class="string">"rentUserId"</span>);</span><br><span class="line">        book.setRentUserId(rentUserId);</span><br><span class="line">        book.setComment((String) rs.get(<span class="string">"comment"</span>));</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Book <span class="title">convertBookFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">        book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">        book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">        java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">        book.setPublishDate(date);</span><br><span class="line">        book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">        Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">        book.setRentUserId(rentUserId);</span><br><span class="line">        book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Bean의-등록"><a href="#Bean의-등록" class="headerlink" title="Bean의 등록"></a>Bean의 등록</h2><p><code>BookDao</code>, <code>UserDao</code>, <code>HistoryDao</code>를 각각 <code>ApplicationContext</code>에 등록하게 되면 다음과 같이 구성됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookStoreConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">"org.mariadb.jdbc.Driver"</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"qwer12#$"</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BookDao <span class="title">bookDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BookDao(jdbcTemplate());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserDao(jdbcTemplate());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HistoryDao <span class="title">historyDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HistoryDao(jdbcTemplate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>만약 <code>Dao</code> 객체들이 여러개가 된다면 이러한 코드 패턴을 여러개를 계속해서 만들어줘야지 됩니다. 이를 간단하게 처리할 수 있는 방법으로 <code>ComponentScan</code>을 제공합니다. <code>ComponentScan</code>은 다음과 같이 사용 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;</span><br><span class="line">    <span class="string">"com.xyzlast.bookstore.dao"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookStoreConfig</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>해당되는 <code>package</code>안의 객체들을 자동으로 <code>ApplicationContext</code>에 등록하게 되는데, 이는 annotation을 기준으로 갖습니다. Spring에서 <code>ComponentScan</code>에 의하여 자동 등록되는 기준 annotation은 다음과 같습니다.</p>
<table>
<thead>
<tr>
<th>종류</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Component</td>
<td>일반적인 객체에 사용됩니다.</td>
</tr>
<tr>
<td>@Repository</td>
<td>DB에 접근되는 객체에 사용됩니다. 일반적으로 <code>DAO</code>, <code>Repository</code> 객체에 적용이 됩니다.</td>
</tr>
<tr>
<td>@Service</td>
<td>Business Logic이 구성되는 Service 객체에 사용됩니다. BL은 여러개의 Repository의 구성으로 만들어집니다.</td>
</tr>
<tr>
<td>@Controller</td>
<td>WebMVC에서 사용되는 객체입니다. Url Request와 연결되는 객체를 지정할 때 사용됩니다.</td>
</tr>
</tbody>
</table>
<p>그리고, 자동등록이 지정된 객체들에 자동으로 추가되어야지 될 내용들을 어떻게 지정해주어야지 될까요? 지금 <code>Dao</code> 객체들은 생성자에 <code>JdbcTemplate</code>이 <code>ApplicationContext</code>에 등록된 객체를 사용할 수 있도록 지정해야 합니다. 이럴때 <code>@Autowired</code>를 이용합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Autowired</code>가 지정된 객체들은 <code>ApplicationContext</code>에서 생성될 순서가 뒤로 밀리게 됩니다. 우선 다른 객체들의 dependency가 없는 객체들부터 우선 생성하고, <code>@Autowired</code>가 지정된 객체들을 찾아서 처리하게 됩니다. 이때, 지정된 객체를 찾는 것은 다음과 같은 순서를 갖습니다.</p>
<ol>
<li><code>@Autowired</code>될 객체의 Bean 이름을 지정한 경우</li>
<li><code>@Autowired</code>될 객체의 type이 동일한 경우</li>
</ol>
<p>위 케이스의 경우, 객체의 type이 동일한 경우입니다. <code>Bean</code>의 이름이 지정되어 있지 않기 때문입니다. 만약에 <code>UserDao</code>, <code>BookDao</code>가 각각 다른 <code>JdbcTemplate</code>를 사용해야지 된다면, <code>@Qualifier</code>를 이용해서 각기 사용할 Bean을 지정해줄 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(<span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span>(<span class="string">"jdbcTemplate2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(@Qualifier(value = <span class="string">"jdbcTemplate"</span>)</span> JdbcTemplate jdbcTemplate) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDao</span><span class="params">(@Qualifier(value = <span class="string">"jdbcTemplate2"</span>)</span> JdbcTemplate jdbcTemplate) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DataSource의-변경"><a href="#DataSource의-변경" class="headerlink" title="DataSource의 변경"></a>DataSource의 변경</h2><p><code>DriverManagerDataSource</code>는 매우 단순한 <code>DataSource</code>입니다. 1개의 <code>connection</code>에 대한 <code>open</code>/<code>close</code>만을 담당하고 있는 매우 단순한 형태이지요. 실무에서는 절대로 사용되지 않는 형태의 <code>DataSource</code>입니다. 실무에서는 <code>JNDI</code> 또는 <code>Connection Pool</code>을 사용합니다.</p>
<p><code>Connection Pool</code>은 미리 <code>Connection</code>을 준비해두고, <code>DAO</code>에서 사용된 <code>Connection</code>을 <code>Pool</code>에 넣어서 관리하는 형태입니다. 이 방식은 다음과 같은 장점을 갖습니다.</p>
<ul>
<li>DB에 대한 가장 큰 부하인 Connection open / close 횟수를 줄여, System의 부하를 줄일수 있습니다.</li>
<li>Web과 같은 동시접근성이 보장되어야지 되는 시스템에서 Connection의 여유분을 만들어서, 시스템의 성능을 높일 수 있습니다.</li>
<li>DB System에 대한 max connection 숫자를 파악할 수 있기 때문에, DB System에 대한 부하 및 성능에 대한 예측이 가능합니다.</li>
</ul>
<p>주로 사용되는 ConnectionPool Library는 다음 5가지를 볼 수 있습니다.</p>
<ul>
<li>apache common-dhcp</li>
<li>tomcat jdbc</li>
<li>boneCP</li>
<li>HikiriCP</li>
<li>c3p0</li>
</ul>
<p>주로 사용되고 있는 <code>apache common-dhcp</code>는 사용버젼에 주의할 필요가 있습니다. <code>1.4.1</code>이전 버젼의 경우 memoryLeak이 발생합니다. 그런데, <code>1.4.1</code> 정식버젼이 아직 release되고 있지 않습니다. 따라서, 다음 선언을 모두 변경하는 것이 좋습니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">group:</span> <span class="string">'commons-dbcp'</span>, <span class="string">name:</span> <span class="string">'commons-dbcp'</span>, <span class="string">version:</span> <span class="string">'1.4'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">group:</span> <span class="string">'org.apache.commons'</span>, <span class="string">name:</span> <span class="string">'commons-dbcp2'</span>, <span class="string">version:</span> <span class="string">'2.1.1'</span></span><br></pre></td></tr></table></figure>
<p>개인적으로는 <code>HikariCP</code>를 추천합니다. 성능이 좋습니다.</p>
<p><img src="https://github.com/brettwooldridge/HikariCP/wiki/HikariCP-bench-2.6.0.png" alt=""></p>
<p><code>ConnectionPool</code>은 다음과 같은 일반적인 속성들을 갖습니다.</p>
<ul>
<li>idleConnectionTestPeriodInMinutes : connection이 쉬고 있는 상태인지 확인하는 주기입니다.</li>
<li>idleMaxAgeInMinutes : connection이 유휴상태로 놓어지는 최대시간입니다. 이 시간 이후, connection은 소멸됩니다.</li>
<li>maxConnections : 최대 connection의 갯수입니다.</li>
<li>minConnections : 최소 connection의 갯수입니다.</li>
<li>acquireIncrement : 한번에 connection을 얻어낼 때, 얻어내는 숫자입니다.</li>
</ul>
<p>application의 최대 성능을 높이기 위해서는 <code>maxConnections</code>와 <code>minConnections</code>의 숫자를 일치시키는 것이 강력 권장합니다. <code>HikariCP</code>를 이용하는 경우 DataSource를 변경하면 다음과 같이 <code>@Configuration</code>의 변경이 필요합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">    dataSource.setDriverClassName(<span class="string">"org.mariadb.jdbc.Driver"</span>);</span><br><span class="line">    dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>);</span><br><span class="line">    dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">"qwer12#$"</span>);</span><br><span class="line">    dataSource.setMaximumPoolSize(<span class="number">10</span>);</span><br><span class="line">    dataSource.setMinimumIdle(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>DataSourc</code>를 변경한 이후에도 기존 코드에 아무런 변경이 없이 적용이 가능합니다. 이는 <code>DI</code>에 의한 <code>IoC</code>의 대표적인 한 예가 될 수 있습니다.</p>
<h2 id="Repository-Pattern"><a href="#Repository-Pattern" class="headerlink" title="Repository Pattern"></a>Repository Pattern</h2><p><code>Spring</code>에서 Logic의 구성은 일반적으로 <code>Repository Pattern</code>을 따를 것을 권고하고 있습니다. <code>Repository Pattern</code>은 BL(Business Logic)과 데이터의 저장(Repository)에 대한 Layer를 명확히 구분시키는 pattern 입니다. 일반적인 구성은 다음과 같이 만들어집니다.</p>
<p><img src="https://i-msdn.sec.s-msft.com/dynimg/IC340233.png" alt=""></p>
<p>데이터의 검색/저장 영역과 그 데이터를 이용하는 BL을 철저하게 구분합니다. 이는 <code>DAO Pattern</code>과는 구분 됩니다. <code>DAO Pattern</code>의 경우, 데이터에 Access를 어떤 Layer에서나 접근이 가능한 차이를 가지고 있습니다.</p>
<p>그래서, Spring으로 구성된 프로젝트를 보면 다음과 같은 package들로 구성되는 경우가 많습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── config</span><br><span class="line">├── controller</span><br><span class="line">├── entity</span><br><span class="line">├── repository</span><br><span class="line">└── service</span><br></pre></td></tr></table></figure>
<p>이제 몇가지 BL을 가지고 Spring에서의 Service를 구현해보도록 하겠습니다.</p>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>이제 BookStore의 BL을 정의해보도록 하겠습니다.</p>
<ul>
<li>user는 book을 빌리거나 반납할 수 있다.</li>
<li>user가 book을 빌리면, point가 10점씩 쌓인다.</li>
<li>point가 100점이 넘어가면 LEVEL이 READER(1)가 된다.</li>
<li>point가 300점이 넘어가면 MVP(2)가 된다.</li>
<li>point가 100점 이하인 경우, 일반유저(NORMAL)이다.</li>
<li>전체 book을 list up 할 수 있으며, 대출이 가능한 책 우선으로 Sort된다.</li>
<li>book은 대출 가능, 대출중, 분실의 3가지의 상태를 갖는다.</li>
<li>user는 자신이 지금까지 빌린 book들의 기록(대출,반납)을 최신 순으로 볼 수 있다.</li>
<li>user의 RENT/RETURN은 모두 History가 남는다.</li>
</ul>
<p>매우 간단한 BL입니다. 그리고, 이 BL에 대한 Action 주체를 기준으로 다음과 같이 명명한 서비스들을 구상할 수 있습니다.</p>
<ul>
<li>UserService: User가 Action의 주체가 되는 서비스입니다.</li>
<li>BookService: Book이 Action의 주체가 되는 서비스입니다.</li>
</ul>
<p>서비스의 명명법은 일반적으로 영문법을 따르게 되며 다음과 같은 영어 문장과 같은 구성을 갖는것이 좋습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">userService.listupRentHistories();</span><br><span class="line">userService.rentBook(Book book);</span><br><span class="line">userService.returnBook(Book book);</span><br><span class="line">bookService.listup();</span><br></pre></td></tr></table></figure>
<p>이에 대한 서비스는 다음과 같이 설계할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">rent</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">returnBook</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span></span>;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">listup</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">List&lt;History&gt; <span class="title">getHistories</span><span class="params">(<span class="keyword">int</span> userId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">listup</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이와 같이 interface는 단순히 객체에 대한 프로그래밍적 요소로만 사용되는 것이 아닌, 프로그램의 in/out에 대한 설계로서 사용이 가능합니다. 우리가 어떠한 application을 작성을 할때, input/output에 대한 정의를 명확히 할 수 있는 경우, interface를 이용해서 코드를 명확히 구성하는 것이 가능합니다. 이제 interface를 기반으로 서비스를 구현해보면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    <span class="keyword">private</span> HistoryDao historyDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserDao userDao, BookDao bookDao, HistoryDao historyDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">        <span class="keyword">this</span>.bookDao = bookDao;</span><br><span class="line">        <span class="keyword">this</span>.historyDao = historyDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rent</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">        User user = userDao.getById(userId);</span><br><span class="line">        Book book = bookDao.getById(bookId);</span><br><span class="line">        <span class="keyword">if</span> (book.getBookStatus() != BookStatus.CanRent || book.getRentUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        user.setPoint(user.getPoint() + <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">100</span> &amp;&amp; user.getPoint() &lt; <span class="number">300</span>) &#123;</span><br><span class="line">            user.setLevel(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">            user.setLevel(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            user.setLevel(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        book.setRentUserId(userId);</span><br><span class="line">        book.setBookStatus(BookStatus.RentNow);</span><br><span class="line"></span><br><span class="line">        userDao.update(user);</span><br><span class="line">        bookDao.update(book);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//<span class="doctag">NOTE:</span> History 기록</span></span><br><span class="line">        History history = <span class="keyword">new</span> History();</span><br><span class="line">        history.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        history.setActionType(HistoryActionType.RENT_BOOK);</span><br><span class="line">        history.setUserId(userId);</span><br><span class="line">        history.setBookId(bookId);</span><br><span class="line">        historyDao.add(history);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 구현된 서비스를 <code>@Service</code>로 등록됩니다. 이제 <code>@Configuration</code>에 등록하는 코드를 확인해보겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;</span><br><span class="line">    <span class="string">"com.xyzlast.bookstore.dao"</span>,</span><br><span class="line">    <span class="string">"com.xyzlast.bookstore.service"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookStoreConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">"org.mariadb.jdbc.Driver"</span>);</span><br><span class="line">        dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"qwer12#$"</span>);</span><br><span class="line">        dataSource.setMaximumPoolSize(<span class="number">10</span>);</span><br><span class="line">        dataSource.setMinimumIdle(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 정상적으로 등록되었는지 확인해보도록 하겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = BookStoreConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImplTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        UserService userService = applicationContext.getBean(UserService.class);</span><br><span class="line">        assertThat(userService).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTest01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Service-Code의-테스트-방법"><a href="#Service-Code의-테스트-방법" class="headerlink" title="Service Code의 테스트 방법"></a>Service Code의 테스트 방법</h2><p><code>@Service</code> 객체들을 모두 가져다 사용이 가능한 것을 볼 수 있습니다. 이제 우리는 <code>Repository Pattern</code>으로 개발할 준비가 모두 마쳐진 상태입니다. 그렇다면 이와 같은 코드를 어떻게 테스트를 할 수 있을까요?</p>
<p><code>rent</code> 코드가 정상적으로 동작하는 것을 확인하기 위해서는 다음 상황을 확인할 수 있어야지 됩니다.</p>
<ul>
<li><code>Book</code>의 상태에 따라 대여가 가능하거나 불가능해야지 됩니다.</li>
<li><code>User</code>의 Point 점수에 따라 Level이 변경이 될 수 있어야지 됩니다.</li>
<li><code>History</code>의 추가가 되어야지 됩니다.</li>
</ul>
<p>위 3가지를 확인하기 위해서는 <code>Repository</code>에 올바른 데이터가 입력되어 있어야지 됩니다. 그리고, 테스트가 정상적으로 동작할 수 있도록 데이터를 준비하더라도 테스트가 반복적으로 실행될 수는 없는 구조입니다. <code>User</code>의 상태가 변경되기 때문이지요. 그렇다면 이런 문제를 회피하면서 테스트를 진행하기 위해서는 어떻게 해야지 될까요?</p>
<p>여기서 한번 우리가 기본적으로 알고 있는 <code>OOP</code>에 대해서 다시 생각해볼 필요가 있습니다. 우리의 테스트 코드는 테스트하고자 하는 객체에 대한 테스트를 진행해야지 됩니다. <code>Service</code> 테스트 코드가 굳이 <code>Repository</code>에 대한 테스트를 진행할 필요가 없다는 것입니다. 그렇다면 <code>Repository</code>를 우리가 원하는 객체만을 반환하게 해줘서 테스트를 진행하면 이 문제를 해결할 수 있습니다.</p>
<p>다시한번 위 3가지의 테스트 조건이 어떻게 통과될 수 있는지 확인해보도록 하겠습니다.</p>
<table>
<thead>
<tr>
<th>상황</th>
<th>해결방안</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Book</code>의 상태에 따라 대여가 가능하거나 불가능해야지 됩니다.</td>
<td>bookDao.getById에서 원하는 상태를 갖는 <code>Book</code>을 얻어낼 수 있으면 가능합니다.</td>
</tr>
<tr>
<td><code>User</code>의 Point 점수에 따라 Level이 변경이 될 수 있어야지 됩니다.</td>
<td><code>User.point</code>, <code>User.level</code>이 테스트 하고자 하는 상태를 갖는 <code>User</code>를 얻어낼 수 있으면 가능합니다.</td>
</tr>
<tr>
<td><code>History</code>의 추가가 되어야지 됩니다.</td>
<td><code>historyDao.add</code>가 호출되어야지 됩니다.</td>
</tr>
</tbody>
</table>
<p>이렇게 설정된 값을 반환하는 테스트 객체를 이용하는 테스트를 <code>mockTest</code>라고 합니다. <code>mockTest</code>는 매우 중요합니다. 모든 <code>application</code>은 <code>Dependency</code>를 갖게 되는데 이 <code>Dependency</code>의 영향을 받지 않는 테스트를 구성하지 않으면, 좋은 테스트 코드를 구현할 수 없습니다. <code>mockTest</code>를 구현하기 위해 자주 사용되는 library는 <code>mokito</code>입니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testCompile <span class="string">group:</span> <span class="string">'org.mockito'</span>, <span class="string">name:</span> <span class="string">'mockito-all'</span>, <span class="string">version:</span> <span class="string">'1.10.19'</span></span><br></pre></td></tr></table></figure>
<p>다음은 구성된 테스트 코드입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockUserServiceImplTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> BOOK상태가_정상적이지_않은_경우_테스트() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        <span class="comment">//대여되어 있는 상태</span></span><br><span class="line">        book.setBookStatus(BookStatus.RentNow);</span><br><span class="line"></span><br><span class="line">        BookDao bookDao = mock(BookDao.class);</span><br><span class="line">        when(bookDao.getById(any())).thenReturn(book);</span><br><span class="line">        UserDao userDao = mock(UserDao.class);</span><br><span class="line">        HistoryDao historyDao = mock(HistoryDao.class);</span><br><span class="line"></span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl(userDao, bookDao, historyDao);</span><br><span class="line">        assertThat(userService.rent(<span class="number">0</span>, <span class="number">0</span>)).isFalse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> BOOK의_RENTUSERID가_NULL이_아닌경우_테스트() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">int</span> targetUserId = <span class="number">0</span>;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setBookStatus(BookStatus.CanRent);</span><br><span class="line">        book.setRentUserId(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        BookDao bookDao = mock(BookDao.class);</span><br><span class="line">        when(bookDao.getById(any())).thenReturn(book);</span><br><span class="line">        UserDao userDao = mock(UserDao.class);</span><br><span class="line">        HistoryDao historyDao = mock(HistoryDao.class);</span><br><span class="line"></span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl(userDao, bookDao, historyDao);</span><br><span class="line">        assertThat(userService.rent(targetUserId, <span class="number">0</span>)).isFalse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 정상적인_RENT가_되는_경우_사용자Level이_READER가_되는_경우() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//User.point = 90, level이 1로 변경되는 것 확인</span></span><br><span class="line">        testRentWithUserCondition(<span class="number">90</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//User.point = 290, level이 2로 변경되는 것 확인</span></span><br><span class="line">        testRentWithUserCondition(<span class="number">290</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">//User.point = 50, level이 0으로 유지되는 것 확인</span></span><br><span class="line">        testRentWithUserCondition(<span class="number">50</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testRentWithUserCondition</span><span class="params">(<span class="keyword">int</span> currentPoint, <span class="keyword">int</span> currentLevel, <span class="keyword">int</span> expectLevel)</span> </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setBookStatus(BookStatus.CanRent);</span><br><span class="line">        book.setRentUserId(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setPoint(currentPoint);</span><br><span class="line">        user.setLevel(currentLevel);</span><br><span class="line"></span><br><span class="line">        BookDao bookDao = mock(BookDao.class);</span><br><span class="line">        when(bookDao.getById(any())).thenReturn(book);</span><br><span class="line">        UserDao userDao = mock(UserDao.class);</span><br><span class="line">        when(userDao.getById(any())).thenReturn(user);</span><br><span class="line">        HistoryDao historyDao = mock(HistoryDao.class);</span><br><span class="line"></span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl(userDao, bookDao, historyDao);</span><br><span class="line">        <span class="comment">//Rent가 정상적으로 진행되는 것을 확인</span></span><br><span class="line">        assertThat(userService.rent(<span class="number">0</span>, <span class="number">0</span>)).isTrue();</span><br><span class="line">        <span class="comment">//Rent가 진행된 후, 사용자의 Level이 바뀐것을 확인</span></span><br><span class="line">        assertThat(user.getLevel()).isEqualTo(expectLevel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//book, user가 update되는 코드가 호출되는 것을 확인</span></span><br><span class="line">        verify(bookDao, times(<span class="number">1</span>)).update(book);</span><br><span class="line">        verify(userDao, times(<span class="number">1</span>)).update(user);</span><br><span class="line">        <span class="comment">//History가 추가 되는것을 확인</span></span><br><span class="line">        verify(historyDao, times(<span class="number">1</span>)).add(any());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mockTest</code>는 의존성을 제거하고 로직을 테스트할 수 있는 좋은 방법입니다. 그렇다고 <code>Repository</code>를 직접 이용하는 테스트 코드가 필요없다는 것은 아닙니다. 어떤 항목을 테스트해야될지 개발자들이 확인할 필요가 있습니다.</p>
<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><p>지금까지 구현된 Service, Repository Layer는 결정적인 문제를 가지고 있습니다. 예를 들어, rentBook action에서 book의 상태를 업데이트 한 후에, DB의 문제나 application의 exception이 발생했다면 어떤 문제가 발생할까요?<br>지금의 JdbcTemplate은 각 Repository Layer단으로 Connection이 분리 되어 있습니다. 따라서 한쪽에서 Exception이 발생하더라도, 기존 update 사항에 대해서는 DB에 그대로 반영이 되어버립니다. 이건 엄청난 문제를 발생시킵니다. Repository는 우리가 서비스를 만드는 도구이고, 결국은 사용자나 BL의 한개의 action으로 DB의 Transaction이 적용이 되어야지 되는데, 이러한 규칙을 모두 날려버리게 되는 것입니다.</p>
<p>다시 한번 정리하도록 하겠습니다. Service의 method는 BL의 기본 단위가 됩니다. 따라서, Transaction의 단위가 Service의 method 단위가 되어야지 됩니다. 간단히 sudo 코드를 작성한다면 rent method는 다음과 같이 작성되어야지 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rent</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">    Transaction.begin();</span><br><span class="line">    User user = userDao.get(userId);</span><br><span class="line">    Book book = bookDao.get(bookId);</span><br><span class="line"></span><br><span class="line">    user.setPoint(user.getPoint() + <span class="number">10</span>);</span><br><span class="line">    user.setLevel(getUserLevel(user.getPoint()));</span><br><span class="line">    book.setRentUserId(user.getId());</span><br><span class="line">    book.setStatus(BookStatus.RentNow);</span><br><span class="line"></span><br><span class="line">    UserHistory history = <span class="keyword">new</span> UserHistory();</span><br><span class="line">    history.setUserId(userId);</span><br><span class="line">    history.setBookId(book.getId());</span><br><span class="line">    history.setAction(HistoryActionType.RENT);</span><br><span class="line"></span><br><span class="line">    userDao.update(user);</span><br><span class="line">    bookDao.update(book);</span><br><span class="line">    userHistoryDao.add(history);</span><br><span class="line"></span><br><span class="line">    Transaction.commit();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Transaction은 매우 골치아픈 개념입니다. 먼저 지금 사용중인 DataSource는 직접적으로 JDBC에 연결되는 Connection입니다. 그런데, 이를 Hibernate의 session 또는 iBatis의 ObjectMapper들을 사용한다면 완전히 다른 Transaction 기술을 사용해야지 됩니다. 지금까지 기술에 종속적이지 않은 <code>Service</code>를 작성하고 있는데, 이제 Transaction에 의한 기술 종속적 코드로 변경이 되어야지 되는 상황이 되어버린것입니다. 그래서, 이 경우를 해결하기 위해서 Transaction의 기술들에 대한 interface를 spring은 제안하고 있습니다. 바로 <code>org.springframework.transaction.PlatformTransactionManager</code>가 바로 그 interface입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlatformTransactionManager</span> </span>&#123;</span><br><span class="line">    <span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(@Nullable TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Transaction을 얻어내고, Transaction을 commit, rollback하는 간단한 구조로 되어 있습니다. 이러한 기본 구조는 우리가 Dao Layer를 이용해서 Transaction을 사용하는데 충분합니다.<br>PlatformTransactionManager를 이용한 Transaction 구현을 간단한 sudo code로 구현하면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TransactionStatus status = transactionManager.getTransaction(definition);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ..do something</span></span><br><span class="line">        transactionManager.commit(status);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">        transactionManager.rollback(status)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>전에 보던 Template-callback pattern과 동일한 패턴의 코드가 완성됩니다. TransactionManager의 생성자에는 DataSource interface를 구현하고 있기 때문에 Dao Layer에서 사용하는 Connection을 한번에 묶어서 처리가 가능합니다. Spring Transaction을 이용한 코드는 다음과 같이 구현되어야지 됩니다.</p>
<p>먼저 <code>@Configuration</code>에 다음과 같이 등록합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UserService는 다음과 같이 변경되어야지 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rent</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">    TransactionStatus transaction = transactionManager.getTransaction(<span class="keyword">new</span> DefaultTransactionDefinition());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        User user = userDao.getById(userId);</span><br><span class="line">        Book book = bookDao.getById(bookId);</span><br><span class="line">        <span class="keyword">if</span> (book.getBookStatus() != BookStatus.CanRent || book.getRentUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        user.setPoint(user.getPoint() + <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">100</span> &amp;&amp; user.getPoint() &lt; <span class="number">300</span>) &#123;</span><br><span class="line">            user.setLevel(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">            user.setLevel(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            user.setLevel(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        book.setRentUserId(userId);</span><br><span class="line">        book.setBookStatus(BookStatus.RentNow);</span><br><span class="line"></span><br><span class="line">        userDao.update(user);</span><br><span class="line">        bookDao.update(book);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//<span class="doctag">NOTE:</span> History 기록</span></span><br><span class="line">        History history = <span class="keyword">new</span> History();</span><br><span class="line">        history.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        history.setActionType(HistoryActionType.RENT_BOOK);</span><br><span class="line">        history.setUserId(userId);</span><br><span class="line">        history.setBookId(bookId);</span><br><span class="line">        historyDao.add(history);</span><br><span class="line">        transactionManager.commit(transaction);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        transactionManager.rollback(transaction);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 Transaction이 적용된 코드가 완성되었습니다.</p>
<h2 id="annotation을-이용한-Transaction의-구현"><a href="#annotation을-이용한-Transaction의-구현" class="headerlink" title="annotation을 이용한 Transaction의 구현"></a>annotation을 이용한 Transaction의 구현</h2><p>그런데, 지금까지 구현된 코드에는 한가지 문제가 있습니다. Transaction은 기술적인 영역으로 Service 객체에는 어울리지 않는 내용입니다. Service는 BL의 집합이라는 것을 다시 한번 상기해주시길 바랍니다. BL에 기술적인 요소가 들어가게 되면, 기술적인 요소에 따른 BL의 수정이 가해질 수 있습니다. 따라서, Spring에서는 이를 분리하는 것을 제안하고 있으며, 특히 Transaction에서는 @Transactional annotaion을 이용한 분리를 제안하고 있습니다.</p>
<p>@Transactional은 method, class에 모두 적용 가능한 annotation입니다. @Transactional을 사용하기 위해서는 <code>@Configuration</code>이 다음과 같이 변경이 필요합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;</span><br><span class="line">    <span class="string">"com.xyzlast.bookstore.dao"</span>,</span><br><span class="line">    <span class="string">"com.xyzlast.bookstore.service"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookStoreConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">"org.mariadb.jdbc.Driver"</span>);</span><br><span class="line">        dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"qwer12#$"</span>);</span><br><span class="line">        dataSource.setMaximumPoolSize(<span class="number">10</span>);</span><br><span class="line">        dataSource.setMinimumIdle(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@EnableTransactionManagement</code>에 주의해주시길 바랍니다. 이제 Transaction을 다음과 같이 적용하면 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">rent</span><span class="params">(<span class="keyword">int</span> userId, <span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">    User user = userDao.getById(userId);</span><br><span class="line">    Book book = bookDao.getById(bookId);</span><br><span class="line">    <span class="keyword">if</span> (book.getBookStatus() != BookStatus.CanRent || book.getRentUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BOOK의 상태가 정상적이지 않습니다."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user.setPoint(user.getPoint() + <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">100</span> &amp;&amp; user.getPoint() &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        user.setLevel(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user.getPoint() &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">        user.setLevel(<span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        user.setLevel(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    book.setRentUserId(userId);</span><br><span class="line">    book.setBookStatus(BookStatus.RentNow);</span><br><span class="line"></span><br><span class="line">    userDao.update(user);</span><br><span class="line">    bookDao.update(book);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//<span class="doctag">NOTE:</span> History 기록</span></span><br><span class="line">    History history = <span class="keyword">new</span> History();</span><br><span class="line">    history.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">    history.setActionType(HistoryActionType.RENT_BOOK);</span><br><span class="line">    history.setUserId(userId);</span><br><span class="line">    history.setBookId(bookId);</span><br><span class="line">    historyDao.add(history);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>이번에는 Spring JDBC를 이용한 DB 접근 방법에 대해서 알아봤습니다. Spring을 사용중이지만, 외부 Library의 도움을 받지 못하는 경우에 매우 좋은 선택입니다. 그리고 DataSource에 대해서도 알아봤습니다. DataSource는 매우 중요한 Library입니다. DB Connection을 관리하고 있기 때문에 이에 대한 세부설정은 전체 솔루션 성능에 큰 영향을 미치게 됩니다. Transaction은 DB를 다룰때 매우 중요한 이슈입니다.</p>
<p>마지막으로 <code>Repository Pattern</code>에 대해서 알아봤습니다. <code>Service</code>, <code>Repository</code>로 만들어지는 구조는 Spring을 사용한 BL Logic을 구성하는 application의 기본 구조이기도합니다. 그리고, <code>Repository Pattern</code>을 테스트하는 방법들 중에서 <code>mockTest</code>에 대해서도 알아봤습니다.</p>
<p>하나하나가 매우 중요한 개념입니다. 몸으로도 개념으로도 익히는 것이 중요합니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java-spring/">study,java,spring</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/05/05-04-sample-app/"><span>05-04.SampleApplication(4)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/05/05-04-sample-app/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-04T23:58:40.000Z">
          2018-02-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-4-TemplateCallback-pattern"><a href="#SampleApplication-4-TemplateCallback-pattern" class="headerlink" title="SampleApplication(4) - TemplateCallback pattern"></a>SampleApplication(4) - TemplateCallback pattern</h1><h2 id="코드-정리-객체간의-중복-코드-정리"><a href="#코드-정리-객체간의-중복-코드-정리" class="headerlink" title="코드 정리 - 객체간의 중복 코드 정리"></a>코드 정리 - 객체간의 중복 코드 정리</h2><p>지금까지 우리는 books라는 한개의 table에 CRUD action을 진행해왔습니다. 그렇지만, 개발에서는 한개의 Table만에 CRUD를 하는 경우보다, 한 Action에 대하여 여러개의 Table을 CRUD 하게 되는 것이 일반적입니다.</p>
<p>그래서, 이 두개의 개념을 나누게 되는데요.<br>하나의 Action이라는 것은 Business Logic이라고 할 수 있고, 한 Table에 대한 CRUD는 DB에 종속적인 작업이라고 할 수 있습니다.<br>전자를 일반적으로 Service라고 지칭하고, 후자를 DAO (Data Access Object)라고 지칭하는 것이 일반적입니다. 그리고, DB를 통해서 처리되는 Table 단위 또는 Query 단위의 Object들을 Entity(or model)라고 명명합니다.</p>
<p>이와 같은 이름으로 package로 나누게 되는 것이 일반적입니다. dao, entities, service package를 나누것과 같이 이런 식으로 나눠주는 것이 좋습니다.</p>
<p>1개의 Service는 여러개의 DAO를 가지고 있고, DAO를 이용한 BL을 서술하는 것이 일반적입니다. DAO는 최대한 단순하게 Table에 대한 Query들로 구성이 되고, 그 Query를 통해서 결과를 얻어내는 수단으로 주로 사용됩니다. bookstore에 Business Logic(BL)을 추가하기 전에 book의 상태를 서술할수 있는 property와 현재 책을 빌려간 사용자의 정보를 저장할 수 있는 Column을 두개 추가하고, users table을 추가해서 Dao를 좀더 구성해보도록 하겠습니다.</p>
<p>변경된 table의 구조가 반영된 것으로 docker에 새로운 image를 올려뒀습니다. 기존 container를 삭제시키고, 새로운 docker container를 실행시켜주세요.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">4306</span>:<span class="number">3306</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">94</span>.<span class="number">18</span>:<span class="number">15000</span>/study-container:<span class="number">003</span> mysqld_safe</span><br></pre></td></tr></table></figure>
<p>새로운 Docker Image안에 들어있는 db의 table 구조는 다음과 같습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------+</span><br><span class="line">| Tables_in_bookstore |</span><br><span class="line">+---------------------+</span><br><span class="line">| books               |</span><br><span class="line">| histories           |</span><br><span class="line">| users               |</span><br><span class="line">+---------------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; describe users;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | <span class="built_in">Type</span>        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(<span class="number">11</span>)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(<span class="number">50</span>) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(<span class="number">12</span>) | NO   |     | NULL    |                |</span><br><span class="line">| point    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">| level    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; describe users;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | <span class="built_in">Type</span>        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(<span class="number">11</span>)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(<span class="number">50</span>) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(<span class="number">12</span>) | NO   |     | NULL    |                |</span><br><span class="line">| point    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">| level    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; describe histories;</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| Field      | <span class="built_in">Type</span>      | Null | Key | Default           | Extra                       |</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| id         | int(<span class="number">11</span>)   | NO   | PRI | NULL              | auto_increment              |</span><br><span class="line">| userId     | int(<span class="number">11</span>)   | NO   | MUL | NULL              |                             |</span><br><span class="line">| bookId     | int(<span class="number">11</span>)   | NO   | MUL | NULL              |                             |</span><br><span class="line">| actionType | int(<span class="number">11</span>)   | NO   |     | NULL              |                             |</span><br><span class="line">| insertDate | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br></pre></td></tr></table></figure>
<p>위 <code>Service</code>와 <code>DAO</code>에 대한 정의를 보면 지금까지 작성된 <code>BookService</code>는 <code>DAO</code>의 성격이 더 강한 것을 알 수 있습니다. 그렇다면 package에 대한 전체적인 변경을 해보도록 하겠습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── dao</span><br><span class="line">├── entity</span><br><span class="line">└── service</span><br></pre></td></tr></table></figure>
<p>이 구조는 <code>Business Logic</code>을 다루는 package의 일반적인 구조가 될 수 있습니다. 추후에 <code>WebApplication</code>에서 package에 대한 구조를 좀 더 깊게 다뤄보도록 하겠습니다.</p>
<p>그리고 3개의 Table에 해당되는 <code>DAO</code>인 <code>BookDao</code>, <code>UserDao</code>, <code>HistoryDao</code>를 추가합니다. 그리고, 각 <code>Dao</code>에서 해당되는 <code>Entity</code>들을 모두 추가하면 일단 기본 포멧은 꾸며질 수 있게 됩니다.</p>
<h2 id="Entity-or-Model"><a href="#Entity-or-Model" class="headerlink" title="Entity (or Model)"></a>Entity (or Model)</h2><p>Table 단위의 접근 객체를 의미합니다. 이는 DAO에서 처리하는 객체 단위가 될 수 있습니다. 조금 더 깊은 내용들은 <code>ORM(Oriented Relation Model)</code>에서 좀 더 깊게 다루도록 하겠습니다.</p>
<p>기존 Book의 경우, <code>status</code>와 <code>rentUserId</code>가 추가되었습니다. 이를 단순히 <code>int</code> 값으로 처리가 가능합니다. 그런데, 이렇게 int 값으로 처리를 하게 되면 int 값에 대한 내용 서술이 되지 않습니다. 이런 경우 이 값을 <code>enum</code> 형태로 만들어서 처리해주면 좋습니다. 이 부분에 대해서는 논쟁이 조금 있습니다. 상태의 경우 <code>code table</code>을 통해서 처리가 되는 것이 일반적입니다. 이렇게 <code>enum</code>을 이용할 때의 장점은 무엇이 있을까요? 이 부분에 대해서는 각 개발자들이 한번 공부를 해보는 것이 어떨까 생각을 하고 있습니다. 약간의 논쟁이 되는 부분중 하나라고 생각합니다. (<a href="http://woowabros.github.io/tools/2017/07/10/java-enum-uses.html" target="_blank" rel="noopener">http://woowabros.github.io/tools/2017/07/10/java-enum-uses.html</a>)</p>
<p>BookStatus를 enum으로 정의하면 다음 코드로 표현이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BookStatus &#123;</span><br><span class="line">    CanRent(<span class="number">0</span>),</span><br><span class="line">    RentNow(<span class="number">1</span>),</span><br><span class="line">    Missing(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    BookStatus(<span class="keyword">int</span> value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BookStatus <span class="title">parse</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(value) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span> : <span class="keyword">return</span> CanRent;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> : <span class="keyword">return</span> RentNow;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span> : <span class="keyword">return</span> Missing;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BookStatus</code>를 반영한 <code>Book</code> 코드는 다음과 같이 구성됩니다. (lombok을 찬양합시다.)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Date publishDate;</span><br><span class="line">    <span class="keyword">private</span> BookStatus bookStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>User</code>, <code>History</code>에 대한 <code>Entity</code>를 구성해보도록 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> point;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">History</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> HistoryActionType actionType;</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DAO의-기능"><a href="#DAO의-기능" class="headerlink" title="DAO의 기능"></a>DAO의 기능</h2><p><code>DAO</code>는 일반적으로 Data에 접근하고 처리할 수 있는 기능들을 제공합니다. 이는 Table의 CRUD기능을 의미하게 됩니다. 이제 일반적인 CRUD의 경우, 다음 Code로 정의가 가능할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookStoreDao</span>&lt;<span class="title">T</span>, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function">T <span class="title">getById</span><span class="params">(K id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">update</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이렇게 <code>interface</code>를 제공하게 되면, 객체들을 만들때 어떤 객체들을 다 만들어줘야지 되는지를 좀 더 명확히 해줄 수 있습니다. 그리고 구현이 되는 객체가 어떤 일을 할 수 있는지에 대한 선언을 해줄 수 있습니다. 이제 구현되는 <code>BookDao</code>를 한번 구현해 보도록 하겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select count(*) from books"</span>);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        rs.next();</span><br><span class="line"></span><br><span class="line">        Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"delete from books"</span>);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select id, name, author, status, rentUserId, comment, publishDate from books"</span>);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            Book book = <span class="keyword">new</span> Book();</span><br><span class="line">            book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">            book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">            book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">            java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">            Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">            book.setRentUserId(rentUserId);</span><br><span class="line">            book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">            books.add(book);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select id, name, author, publishDate, comment, status, rentUserId from books where id=?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, id);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">        Book book = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            book = <span class="keyword">new</span> Book();</span><br><span class="line">            book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">            book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">            book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">            java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">            Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">            book.setRentUserId(rentUserId);</span><br><span class="line">            book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"delete from books where id = ?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 여기서 중복 코드를 제거해보는 절차를 진행해보고자 합니다. 먼저 계속해서나오는 <code>ResultSet</code>을 <code>Book</code>으로 변환시키는 코드가 계속해서 중복되고 있는 것을 볼 수 있습니다.</p>
<p>이를 따로 뽑아내면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Book <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Book book = <span class="keyword">new</span> Book();</span><br><span class="line">    book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">    book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">    book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">    java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">    book.setPublishDate(date);</span><br><span class="line">    book.setPublishDate(date);</span><br><span class="line">    book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">    Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">    book.setRentUserId(rentUserId);</span><br><span class="line">    book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> book;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DB에서 Query를 실행시키는 코드는 두가지의 패턴을 가지고 있습니다. <code>add</code>, <code>update</code>, <code>delete</code>와 같이 query를 실행시키는 코드와 <code>getById</code>, <code>getAll</code>과 같이 query의 실행 후 그 결과(<code>ResultSet</code>)를 이용해서 객체를 만들어주는 코드로 나눌 수 있습니다.</p>
<h3 id="Query를-단순-실행하는-코드"><a href="#Query를-단순-실행하는-코드" class="headerlink" title="Query를 단순 실행하는 코드"></a>Query를 단순 실행하는 코드</h3><p>DB에서 값을 처리하는 과정은 다음과 같습니다.  <code>Connection</code>을 얻어내고 <code>PreparedStatement</code>를 구성하고, <code>PreparedStatement</code>를 <code>Close</code>시켜주고, <code>Connection</code>을 <code>Close</code>시켜주게 됩니다. 이는 정해진 패턴이고 계속되는 중복 코드를 가지고 오게 됩니다.</p>
<p>이제 이 코드는 다음과 같이 보여줄 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementProcess</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Connection conn = connectionFactory.getConnection();</span><br><span class="line">    PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">    process.doProcess(st);</span><br><span class="line">    st.execute();</span><br><span class="line">    st.close();</span><br><span class="line">    conn.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이렇게 수정하면 다음 코드들은 다음과 같이 수정이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"delete from books where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기존 코드와 비교해서 어느정도 코드가 줄어드는지 확인해보시길 바랍니다. 이렇게 시작 Process와 종료 Process가 동일한데 중간 Action 만이 변경되는 코드를 위와 같이 구성하는 패턴을 <code>Template Pattern</code>이라고 합니다.</p>
<h3 id="Query의-실행결과를-이용하는-경우"><a href="#Query의-실행결과를-이용하는-경우" class="headerlink" title="Query의 실행결과를 이용하는 경우"></a>Query의 실행결과를 이용하는 경우</h3><p>Query를 단순 실행하는 패턴과 거의 동일합니다. 패턴의 코드는 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Connection conn = connectionFactory.getConnection();</span><br><span class="line">    PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">    process.doProcess(st);</span><br><span class="line"></span><br><span class="line">    ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">    T result = process.convertFromResultSet(rs);</span><br><span class="line"></span><br><span class="line">    rs.close();</span><br><span class="line">    st.close();</span><br><span class="line">    conn.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>적용된 Pattern을 적용하면 <code>BookDao</code>는 다음과 같이 변경할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select count(*) from books"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> count.intValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"delete from books"</span>, (st) -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, status, rentUserId, comment, publishDate from books"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;List&lt;Book&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    books.add(convertBookFromResultSet(rs));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> books;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, publishDate, comment, status, rentUserId from books where id=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Book&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                st.setInt(<span class="number">1</span>, id);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Book <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Book book = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                    book = convertBookFromResultSet(rs);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> book;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">            st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">            st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">            st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">            st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">            st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">            st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">            st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">            java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">            st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">            st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">            st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">            st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"delete from books where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementProcess</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementAndResultSetProcess</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">        <span class="function">T <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        T result = process.convertFromResultSet(rs);</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Book <span class="title">convertBookFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">        book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">        book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">        java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">        book.setPublishDate(date);</span><br><span class="line">        book.setPublishDate(date);</span><br><span class="line">        book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">        Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">        book.setRentUserId(rentUserId);</span><br><span class="line">        book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>여기서 반영된 코드는 이제 <code>Query</code>를 실행시키는 역활만을 담당하게 됩니다. 이제 좀더 <code>OOP</code>적인 코드가 될 수 있게 됩니다.<br><code>DAO</code>는 DB에 <code>CRUD</code>를 행합니다. <code>DAO</code>에서 <code>CRUD</code>를 처리할 때, 이제 DB에 대한 연결, Query의 전달만을 처리하는 것으로 역활을 담당하면 이 역활을 타 DAO(UserDao, HistoryDao)가 같이 사용할 수 있게 됩니다.</p>
<h2 id="Refactoring-SQL-실행부"><a href="#Refactoring-SQL-실행부" class="headerlink" title="Refactoring SQL 실행부"></a>Refactoring SQL 실행부</h2><p>이제 DB에서의 실행부를 분리해보도록 하겠습니다. <code>SqlExecutor</code>라는 객체로 만들어서 따로 뽑아주고, 그에 대한 interface 역시 정리해줍니다. 그럼 코드는 다음과 같은 형태가 될 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlExecutor</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        T result = process.convertFromResultSet(rs);</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>DAO</code>에서는 <code>ConnectionFactory</code>가 아닌 <code>SqlExecutor</code>를 이용해서 처리하도록 변경합니다. 생성자가 다음과 같이 변경될 필요가 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SqlExecutor sqlExecutor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(SqlExecutor sqlExecutor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.sqlExecutor = sqlExecutor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String sql = <span class="string">"select count(*) from books"</span>;</span><br><span class="line">    <span class="keyword">return</span> sqlExecutor.executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> count.intValue();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 구성된 <code>BookDao</code>, <code>UserDao</code>, <code>HistoryDao</code>를 구성하는 <code>applicaiton-context.xml</code>은 다음과 같습니다. <code>@Configuration</code>도 같이 첨부합니다. 참고해보시길 바랍니다.</p>
<h2 id="코드-정리-Exception의-처리"><a href="#코드-정리-Exception의-처리" class="headerlink" title="코드 정리 - Exception의 처리"></a>코드 정리 - Exception의 처리</h2><p>지금까지 보시면 SqlExecutor를 이용한 코드의 간결화를 해온것을 알 수 있습니다.</p>
<p>마지막으로, 지금 저희 코드에 중복이 되는 코드를 찾아보도록 합시다.<br>딱히 문제가 특출나게 보이지는 않습니다. 지금까지 상당한 refactoring을 통해서 변경시킨 코드에 문제가 쉽게 보이면 그것 역시 문제가 될 수 있습니다.</p>
<p>지금 모든 코드에 나타나 있는 Exception이 선언되어 있습니다. DB access 코드에 원래 일괄적으로 들어가 있어야할 Exception들은 다음과 같습니다.</p>
<ul>
<li>InstantiationException : Class.forName 에서 객체의 이름이 아닌, interface의 이름이 들어간 경우에 발생하는 에러.</li>
<li>IllegalAccessException : Db Connection시, 권한이 없거나 id/password가 틀린 경우에 발생하는 에러</li>
<li>ClassNotFoundException : Class.forName 을 이용, DB Connection 객체를 생성할 때 객체의 이름이 틀린 경우에 발생하는 에러</li>
<li>SQLException : SQL query가 잘못된 Exception입니다.</li>
</ul>
<p>Java는 2개의 Exception type을 가지고 있습니다. checked exception과 Runtime Exception인데요. checked exception의 경우, 이 exception이 발생하는 경우에는 반드시 exception을 처리해줘야지 됩니다. 또는 상위 method로 throw를 해줘야지 됩니다.</p>
<p>Runtime exception은 상위에서 처리를 안해줘도 되고요. 대표적인 것은 NullPointerException, UnsupportedOperationException, IllegalArgumentException 등이 있습니다.</p>
<p>이 부분은 매우 중요한 개념입니다. java에서의 exception은 사용자가 처리해줘야지 될 것(체크 해야지 될 exception)과 Runtime 시(실행시에) 확인되어야지 될 것들로 나뉘게 됩니다. exception에 대하여 보다더 확실한 처리를 해주길 바란 java의 설계 원칙이지만, 근간에는 비판이 좀 많은 부분이기도 합니다. java의 exception에 대한 정리를 한번 해주시는 것이 필요합니다.</p>
<p>그럼, 지금 저희가 사용한 코드중에서 getConnection() method를 확인해보겠습니다. Exception은 원래 이렇게 처리가 되어야지 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">    Connection conn = DriverManager.getConnection (<span class="keyword">this</span>.connectionString, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password);</span><br><span class="line">    <span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 method는 이 4개의 exception을 반드시 처리하도록 되어 있습니다. 또는 이 4개의 exception을 사용한 method로 던져줘서 상위 method에서 처리하도록 되어 있는데요. DB 접속과 SQL query가 잘못된 경우에 대한 exception 처리는 과연 할 수 있을까요? 이 Exception은 처리할 수 없는 Exception을 넘겨줘서 되는 것이 아닌가. 라는 생각을 할 수 있습니다. 잘 보면 대부분의 DB 접속시에 나오는 대부분의 Exception은 처리가 불가능한 Exception이라고 할 수 있습니다. 에러의 내용은 도움이 될 수 있지만, 이 에러가 발생했을 때 어떠한 처리를 하지를 못하는 경우가 대다수라는거지요.</p>
<p>어떤 방법으로 Exception을 처리할지는 이 코드를 사용하는 곳에서 어떻게 할지를 정해보는것이 좋습니다. 예를 들어, <code>SqlExecutor</code>에서 발생하는 에러를 모두 <code>DaoException</code>으로 만들어서 처리하고, log를 남기는 것도 방법입니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><ul>
<li>객체간의 코드중복은 최대한 줄여야지 됩니다. 이를 남겨두면 결국은 코드의 기술부채로서 남습니다.</li>
<li>코드중복을 없애는 방법중에서 유용하지만, 어렵지만 좋은 Pattern이 Template Pattern을 이용해서 처리하는 것입니다.</li>
<li>Java의 Exception은 Check-Exception과 Runtime-Exception으로 구분되고 있습니다. java나 library들에서 제공되는 객체들의 Check-Exception은 남겨두는 것이 좋지만, BL Logic에서의 Check-Exception은 독이 되는 것이 대부분입니다. Runtime-Exception 으로 변경시켜서 처리하는 것이 좋습니다.</li>
</ul>
<p>다음은 지금까지 구성된 코드를 <code>Spring</code>으로 구성되는 BookStore를 만나보실 수 있을 것입니다.</p>
<p>ps: UserDao, HistoryDao 코드를 모두 만들어서 와주시길 바랍니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java-refactoring/">study, java, refactoring</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/05-03-sample-app-md/"><span>05-03.SampleApplication(3)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/05-03-sample-app-md/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:48:40.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-3-DIP"><a href="#SampleApplication-3-DIP" class="headerlink" title="SampleApplication(3) - DIP"></a>SampleApplication(3) - DIP</h1><p>지금까지 간단한 코드와 그 코드에 대한 테스트를 행하는 방법에 대해서 알아봤습니다. 그리고 간단한 table의 CRUD를 하는 방법에 대해서 조금 깊게 들어가봤습니다. 또한 저번 시간의 최대 포인트는 테스트입니다. 테스트를 어떻게 작성을 하는지에 대한 논의와 테스트 코드를 직접 사용해보는 시간을 가져봤습니다. 이번 시간에는 드디어 Spring을 이용한 코드에 대해서 논의해보도록 하겠습니다.기존 코드의 가장 큰 문제는 무엇인가요?</p>
<ul>
<li>DB connection이 변경되는 경우, compile을 다시 해줘야지 된다.</li>
<li>DB connection의 open/close가 모든 method에서 반복된다.</li>
</ul>
<p>크게 보면 이 두가지의 문제가 나오게 됩니다.</p>
<p>Connection은 외부에서 설정할 수 있는 영역입니다. 특히 이런 부분은 config file로 관리가 되는 것이 일반적이고, Enterprise 구성환경에서는 JNDI를 이용한 DB Connection이 제공되는 경우도 많습니다. 따라서, 외부에서 설정이 가능한 것이라고 생각해도 좋습니다. 또한, BookApp은 books table에 CRUD를 하는 것을 목적으로 하는 객체입니다. 객체에 대한 가장 큰 원칙인 단일 책임의 원칙에 의해서, BookApp에서 Connection까지 관리가 되는 것은 영역을 넘어가게 됩니다. 또한, books 이외의 table이 존재할 때, Connection에 대한 코드는 중복될 수 밖에 없는 코드가 됩니다. 따라서 Connection을 제공하는 객체로 따로 분리를 해줍시다.</p>
<p>Connection을 관리, 생성하는 객체이기 때문에 ConnectionFactory라고 명명하고, 객체를 구성합니다. 객체의 코드는 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String connectionString;</span><br><span class="line">    <span class="keyword">private</span> String driverName;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">                                             ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        Class.forName(<span class="keyword">this</span>.driverName).newInstance();</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="keyword">this</span>.connectionString, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConnectionString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> connectionString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionString</span><span class="params">(String connectionString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionString = connectionString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDriverName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> driverName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriverName</span><span class="params">(String driverName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.driverName = driverName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DB의 connection을 관리하는 객체입니다. conneciton만을 관리하기 때문에 <code>단일책임원칙</code>에 맞는 코드라고 할 수 있을 것입니다. 여기서 잠시 다른 곳으로 가서 코드를 좀 더 편하게 적을 방법을 찾아봅시다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compileOnly group: 'org.projectlombok', name: 'lombok', version: '<span class="number">1</span>.<span class="number">16</span>.<span class="number">18</span>'</span><br></pre></td></tr></table></figure>
<p>를 추가합시다.</p>
<p>이제 추가 한 후에는 다음과 같이 코드를 작성할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String connectionString;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String driverName;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">                                             ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        Class.forName(<span class="keyword">this</span>.driverName).newInstance();</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="keyword">this</span>.connectionString, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Getter</code>, <code>@Setter</code>라는 annotation으로 원 코드를 대신해서 사용할 수 있습니다. 코드의 가독성을 높일 수 있는 장점을 갖습니다. 개인적으로 추천하는 library입니다.<br>그리고, 이 객체는 <code>connectionString</code>, <code>driverName</code>, <code>username</code>, <code>password</code> 중 하나라도 없다면 실행할 수 없는 객체입니다. 따라서 생성자에 전 값을 다 추가하는 것이 좋습니다. 이는 객체의 사용방법을 명확히 지정할 수 있습니다.</p>
<p>이제 간략화된 코드를 다시 구성합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String driverName;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String connectionString;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String username;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">        ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        Class.forName(<span class="keyword">this</span>.driverName).newInstance();</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="keyword">this</span>.connectionString, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그리고, 이에 대한 테스트 코드를 작성합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doConnectionFactoryTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">        <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">    assertThat(connectionFactory).isNotNull();</span><br><span class="line">    assertThat(connectionFactory.getConnection()).isNotNull();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>를 이용해서 테스트를 진행합니다.</p>
<p><code>ConnectionFactory</code>를 적용한 <code>BookService</code>를 만들어보도록 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookService</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"insert books(name, author, publishDate, comment) values(?, ?, ?, ?)"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 테스트 코드 역시 같이 업데이트 시켜야지 됩니다. 우리가 만든 코드를 테스트할 수 있어야지 되니까요.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">        <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">    bookService = <span class="keyword">new</span> BookService(connectionFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="IoC-DI"><a href="#IoC-DI" class="headerlink" title="IoC, DI"></a>IoC, DI</h2><p>지금 우리는 테스트 코드내에서 코드가 실행되고 있습니다. 테스트 코드입장에서 생각해보도록 하겠습니다.</p>
<p>우리는 지금 테스트 코드에서 <code>BookService</code>를 실행시키고 있습니다. 그리고 <code>BookService</code>에서 사용할 <code>ConnectionFactory</code>를 <code>BookServiceTest</code>에서 구성해서 사용하고 있습니다.<br>조금 말을 바꿔보면 <code>사용하는 Instance에서 사용할 Instance의 구성을 결정하고 있습니다.</code> 이를 <code>IoC</code>라고 합니다.</p>
<p>여기서, Spring의 가장 주요한 기능을 사용할 때가 되었습니다.</p>
<p>Spring은 <code>IoC</code>를 지원하는 <code>light container</code>입니다.</p>
<p>조금 더 말을 풀어서 표현하면 <strong>Spring은 <code>IoC</code>를 <code>DI(dependency injection)</code>를 통해 지원하는 <code>light container</code>입니다.</strong><br>말이 어려워서 예시를 이용해서 이야기한다면 다음과 같습니다.</p>
<ul>
<li>BookService은 ConnectionFactory에 의존한다.</li>
<li>BookServiceTest는 BookService에 의존한다.</li>
<li>BookServiceTest는 BookService의 ConnectionFactory를 어떻게 바꾸어서 사용할지까지 결정이 가능하다.</li>
</ul>
<p>이는 <code>BookServiceTest</code>는 <code>BookService</code>를 사용하고 있지만, <code>BookService</code>가 의존하고 있는 <code>ConnectionFactory</code>를 자신이 결정해서 사용하고 있습니다. 이때, 의존하는 객체를 변경하는 행위를 <code>DI</code>라고 합니다. 따라서 이 경우를 조금더 어렵게 말하면 다음과 같습니다.</p>
<p><strong>BookServiceTest는 BookService를 DI를 통해 ConnectionFactory를 주입(inject)하여 사용하는 코드입니다.</strong></p>
<p>지금 이야기드린 <code>IoC</code>와 <code>DI</code>는 Spring에서 굉장히 중요한 개념입니다. Spring의 본질이라고 할 수 있습니다. 단순히 <code>WebMvc</code>를 제공하고 있는 것이 Spring이 아닙니다.<br>좀 더 깊게 들어가보도록 하겠습니다.</p>
<h3 id="IoC-Inversion-of-Control"><a href="#IoC-Inversion-of-Control" class="headerlink" title="IoC(Inversion of Control)"></a>IoC(Inversion of Control)</h3><p>IoC는 전통적인 방식에 반대되는 흐름으로 코드가 진행되는 것을 말하는 일반적인 용어입니다. Dependency Injection과 많이 혼동되는데 다른 개념입니다. 오히려 Dependency Inversion Principle이 IoC의 한 형태입니다.</p>
<p>라이브러리와 프레임워크의 관계는 IoC를 설명하는 단골 예입니다. 라이브러리를 사용할 때는 내 코드가 라이브러리 코드(외부 코드)를 호출하지만 프레임워크를 사용할 때는 프레임워크(외부 코드)가 내 코드를 호출합니다. 상호작용(interactive) 프로그래밍 모델과 반응형(reactive) 프로그래밍 모델도 하나의 예입니다.</p>
<p>IoC는 헐리웃에서 오디션이 끝난 후 오디션 참가자에게 하는 말때문에 <code>Hollywood Principle</code>로 불리기도 합니다</p>
<h3 id="DIP-Depencency-Inversion-Principal"><a href="#DIP-Depencency-Inversion-Principal" class="headerlink" title="DIP(Depencency Inversion Principal)"></a>DIP(Depencency Inversion Principal)</h3><p><code>IoC</code>는 <code>DIP</code> 원칙을 구현하는 대표적인 방법입니다. 이는 의존관계를 갖는 모듈 인스턴스의 구성이 추상화에 의존하는 것을 뜻합니다.</p>
<p>좀 더 풀어서 설명하면 추상성이 높고 안정적인 의존 주체 클래스는 구체적이고 불안정한 의존 대상 클래스에 의존해서는 안된다는 원칙으로서, 일반적으로 객체지향의 인터페이스를 통해서 이 원칙을 준수할 수 있게 된다. (상대적으로 고수준인) 클라이언트는 저수준의 클래스에서 추상화한 인터페이스만을 바라보기 때문에, 이 인터페이스를 구현한 클래스는 클라이언트에 어떤 변경도 없이 얼마든지 나중에 교체될 수 있다는 원칙입니다.</p>
<p>말이 계속해서 어려워집니다. 사전적 정의는 더 어렵습니다. 참고로 <code>DIP</code>는 객체지향 프로그래밍의 5대 원칙중 하나입니다.</p>
<blockquote>
<p>SOLID - SRP(단일 책임원칙), OCP(개방-폐쇄 원칙), LSP(리스코치환원칙), ISP(인터페이스분리원칙), DIP(의존성 역전 원칙)</p>
<p>High-level modules should not depend on low-level modules. Both should depend on abstractions.<br>Abstractions should not depend on details. Details should depend on abstractions.</p>
</blockquote>
<p>우리가 개발하는 의존 주체 모듈 인스턴스(BookStore)가 의존 대상 모듈 인스턴스(ConnectionFactory)를 직접 생성하는 것을 전통적 흐름이라고 하면 이 전통적 흐름에서는 의존 대상 코드의 형식이 의존 주체 코드에 의해 결정되기 때문에 의존 대상 코드의 다형성이 동작하기 어렵습니다. 반면 <code>DIP</code> 원칙이 적용되면 구체적인 의존 관계가 추상화에 의해 사용시에 결정되기 때문에 다형성을 적극적으로 활용할 수 있으며 모듈의 재사용성이 높아집니다.</p>
<p>기본적으로 <code>DIP</code>를 따르기 위해서는 의존 주체 모듈 인스턴스와 의존 대상 모듈 인스턴스간의 직접적인 연결이 아닌 중간단계의 <code>interface</code>를 통해서 구현하게 됩니다.</p>
<p>말이 어렵습니다. 코드로서 보면서 이해하는 것이 더 쉽습니다. <code>BookService</code>에 <code>DIP</code>가 적용되지 않을때, 다음과 같이 사용되게 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">            <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 코드에서 <code>DIP</code>가 적용되지 않은 <code>BookService</code>는 <code>ConnectionFactory</code>에 의존적이게 됩니다. 만약에 <code>ConnectionFactory</code>가 변경이 되게 되면 이는 <code>BookService</code>에 영향을 미치게 됩니다. 이는 세부사항(detail)이 구현(Abstractions)를 변경시키는 영향을 미치게 됩니다. <code>DIP</code>를 적용하기 위한 방법으로 <code>DI(Dependency Injection)</code>와 <code>Service Locator</code> 방법이 있습니다.</p>
<h3 id="DI-Dependency-Injection"><a href="#DI-Dependency-Injection" class="headerlink" title="DI(Dependency Injection)"></a>DI(Dependency Injection)</h3><p>많은 사람들이 <code>DI</code>와 <code>DIP</code>를 혼동합니다. <code>DI</code>는 <code>DIP</code>를 구현하는 기법 중 하나입니다. 의존 주체 모듈의 노출된 멤버를 통해 의존 대상 모듈 인스턴스가 제공됩니다. Dependency Injection은 다시 세부적으로 구분될 수 있습니다.</p>
<h4 id="Constructor-Injection"><a href="#Constructor-Injection" class="headerlink" title="Constructor Injection"></a>Constructor Injection</h4><p>Dependency Injection 중 가장 많이 사용되는 방법입니다. 의존 주체 모듈의 생성자 매개변수로 의존 대상 모듈 인스턴스가 주입됩니다. 의존 주체 인스턴스가 생성됨과 동시에 의존성이 해결되기 때문에 일단 의존 주체 인스턴스가 생성되면 의존성 해결 여부를 검사할 필요가 없습니다. 정적 언어의 경우 의존성이 해결되지 않으면 의존 주체 인스턴스를 생성할 수 없기 때문에 모듈간 의존 관계가 문법적으로 명확하게 드러나며 의존성이 누락될 위험이 컴파일러에 의해 차단됩니다.</p>
<h4 id="Property-Injection"><a href="#Property-Injection" class="headerlink" title="Property Injection"></a>Property Injection</h4><p>공용으로 노출된 쓰기 가능한 속성을 통해 의존성을 주입하는 방법입니다. Setter Injection이라고도 부릅니다. 속성이 외부에 노출된 정보를 의미하는지 의존 대상 모듈을 의미하는지 별도의 설명이 없으면 구분하기 어렵습니다. 속성 설정은 의존 주체 인스턴스가 생성된 후에 진행되기 때문에 의존 주체 인스턴스는 필요한 의존성이 해결되지 않은 상태일 수 있습니다.</p>
<h4 id="DI를-이용한-코드-구성"><a href="#DI를-이용한-코드-구성" class="headerlink" title="DI를 이용한 코드 구성"></a>DI를 이용한 코드 구성</h4><p><code>Constructor Injection</code>과 <code>Property Injection</code> 중에서, 예전에는 <code>Property Injection</code>을 권장했습니다. 지금은 압도적으로 <code>Constructor Injection</code>을 선호합니다.<br><code>Constructor Injection</code>을 이용해서 <code>BookService</code>를 구성하면 다음과 같이 구성이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Connnection <span class="title">getConnection</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ConnectionFactory connectionFactory;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookService</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySqlConnectionFactoryImpl</span> <span class="keyword">implements</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OracleSqlConnectionFactoryImpl</span> <span class="keyword">implements</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BookService bookServiceWithMySql = <span class="keyword">new</span> BookService(<span class="keyword">new</span> MySqlConnectionFactoryImpl());</span><br><span class="line">        BookService bookServiceWithOracle = <span class="keyword">new</span> BookService(<span class="keyword">new</span> OracleMySqlConnectionFactoryImpl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위와 같이 구성하게 되면, <code>BookService</code>는 의존성이 <code>interface</code>만 연결이 되게 되며 이는 결합성이 매우 낮은 코드로 사용할 수 있게 됩니다.</p>
<h3 id="Service-Locator"><a href="#Service-Locator" class="headerlink" title="Service Locator"></a>Service Locator</h3><p>Service Locator는 Dependency Injection과는 다른 Dependency Inversion Principle 적용법입니다. Dependency Injection에서 의존 주체 모듈은 의존성을 외부의 주입에 의해 수동적으로 해결하는 반면 Service Locator를 사용하는 의존 주체 모듈은 의존성이 필요한 시점에 능동적으로 의존성 해결을 Service Locator에 요청합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Connnection <span class="title">getConnection</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        IServiceLocator serviceLocator = IServiceLocator.current();</span><br><span class="line">        <span class="keyword">return</span> serviceLocator.resolve(ConnectionFactory.class).getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IServiceLocator serviceLocator = IServiceLocator.current();</span><br><span class="line">        serviceLocator.add(<span class="keyword">new</span> MySqlConnectionFactoryImpl());</span><br><span class="line">        BookService bookServiceWithMySql = <span class="keyword">new</span> BookService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Service Locator는 의존 주체 모듈이 <code>Service Locator</code>를 통해 능동적으로 자신이 사용할 객체들을 찾아서 사용합니다.</p>
<p>Dependency Injection과의 차이점은 다음과 같습니다.</p>
<ul>
<li><code>Service Locator</code>가 적용된 의존 주체 모듈은 외부 모듈 의존관계가 노출되지 않습니다. 위 코드에서는 <code>ConnectionFactory</code>를 사용하는 것을 알아낼 수 없습니다.</li>
<li>의존 주체 모듈은 <code>Service Locator</code>를 직접 사용하기 때문에 <code>Service Locator</code>의 존재를 알고 있으며 필수적으로 의존합니다.</li>
<li><code>Service Locator</code>가 정적인(static) 코드를 통해 제공되기 때문에 병렬(parallel) 테스팅이 어렵습니다.</li>
</ul>
<hr>
<h2 id="Spring을-이용한-IoC-DI"><a href="#Spring을-이용한-IoC-DI" class="headerlink" title="Spring을 이용한 IoC/DI"></a>Spring을 이용한 IoC/DI</h2><p>Spring에서는 <code>IoC</code>를 제공하기 위해서 <code>DI</code>를 이용합니다.<br>Spring을 이용하는 방법을 알아보도록 하겠습니다. 먼저 Spring의 Core만을 추가해서 진행해보도록 하겠습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile group: 'org.springframework', name: 'spring-context', version: '<span class="number">5</span>.<span class="number">0</span>.<span class="number">2</span>.RELEASE'</span><br><span class="line">testCompile group: 'org.springframework', name: 'spring-test', version: '<span class="number">5</span>.<span class="number">0</span>.<span class="number">2</span>.RELEASE'</span><br></pre></td></tr></table></figure>
<p>Spring에서는 <code>IoC</code>를 위한 <code>DI</code> 구성을 <code>Configuration</code>이라고 합니다. 이는 <code>xml</code>과 <code>class</code>로 처리가 가능합니다. 먼저 옛날부터 사용하고 있던 <code>xml</code>을 우선 알아보도록 하겠습니다.</p>
<h3 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h3><p><code>xml</code>파일을 다음과 같이 선언합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span> <span class="attr">class</span>=<span class="string">"com.xyzlast.bookstore.ConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">value</span>=<span class="string">"org.mariadb.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"3"</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">value</span>=<span class="string">"qwer12#$"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookService"</span> <span class="attr">class</span>=<span class="string">"com.xyzlast.bookstore.BookService"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring은 <code>ApplicationContext</code>라는 개념을 가지고 있습니다. <code>ApplicationContext</code>는 이름 그대로 Application에서 사용되는 내용들을 정의하는 역활을 담당합니다. 전에 설명했던 <code>IoC</code>를 위한 <code>DI</code>구성을 정의합니다. 그리고, 정의된 파일을 이용해서 객체를 사용하는 방법은 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBookServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        context = <span class="keyword">new</span> GenericXmlApplicationContext(<span class="string">"/application-context.xml"</span>);</span><br><span class="line">        assertThat(context).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkBeans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConnectionFactory connectionFactory01 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">        ConnectionFactory connectionFactory02 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">        assertThat(connectionFactory01).isEqualTo(connectionFactory02);</span><br><span class="line"></span><br><span class="line">        BookService bookService = context.getBean(BookService.class);</span><br><span class="line">        assertThat(bookService).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>checkBeans</code> 내부를 보면 <code>new</code>를 이용하지 않고, 모든 객체를 사용할 수 있는 것을 볼 수 있습니다. 특이한점이 <code>ConnectionFactory</code>입니다. 두번 객체를 얻어내도 같은 객체로 얻어지는 것을 볼 수 있습니다. 여기서 <code>BookService</code>를 보면 <code>ref</code> 키워드를 이용해서 기존에 만들어진 <code>ConnectionFactory</code>를 <code>BookService</code>에 주입할 수 있는것을 볼 수 있습니다.</p>
<h3 id="Configuration을-이용"><a href="#Configuration을-이용" class="headerlink" title="@Configuration을 이용"></a>@Configuration을 이용</h3><p>Spring에서는 <code>xml</code> 파일이 아닌, <code>@Configuration</code>을 이용하는 것을 좀 더 권장하는 편입니다. <code>@Configuration</code>으로 구성하는 방법은 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConnectionFactory <span class="title">connectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">            <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">        <span class="keyword">return</span>  connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BookService <span class="title">bookService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BookService(connectionFactory());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>구성한 <code>@Configuration</code>은 다음과 같이 활용 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkBeansWithConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(BookServiceConfiguration.class);</span><br><span class="line">    assertThat(context).isNotNull();</span><br><span class="line"></span><br><span class="line">    ConnectionFactory connectionFactory01 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">    ConnectionFactory connectionFactory02 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">    assertThat(connectionFactory01).isEqualTo(connectionFactory02);</span><br><span class="line"></span><br><span class="line">    BookService bookService = context.getBean(BookService.class);</span><br><span class="line">    assertThat(bookService).isNotNull();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="xml-vs-Configuration"><a href="#xml-vs-Configuration" class="headerlink" title="xml vs @Configuration"></a>xml vs @Configuration</h3><p>이 방법들중에서 어떤 방법이 더 좋을지는 개발자들의 취향에 따라서 다르게 할 수도 있습니다. 그런데, 지금 Spring에서 제공되는 Sample이나 강의 대부분이 이젠 <code>@Configuration</code>을 사용하고 있습니다.</p>
<p>예전 코드에 대한 유지보수의 경우에는 ‘xml’을 사용하는 것이 좋겠지만, 신규 Application이나 <code>SpringBoot</code>를 이용하는 Application은 <code>@Configuration</code>을 이용하는것이 좋습니다.</p>
<h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><p>Spring을 사용한 객체의 사용의 장점은 크게 3가지로 볼 수 있습니다.</p>
<ol>
<li>정해진 규칙에 따른 객체의 선언</li>
<li>정의된 객체의 dependency 파악이 가능</li>
<li>테스트의 편의성</li>
</ol>
<p>먼저 정해진 규칙에 따른 객체의 선언은 팀단위의 개발자들에게 일정한 개발 패턴을 만들어줍니다. 정해진 개발 패턴은 정형화된 코드를 만들고, 서로간에 코드의 공유가 원활하게 할 수 있습니다. 그리고, xml을 통한 객체의 의존성 관리는 객체들이 어떠한 구조를 가지고 있는지를 파악하는데 도움을 줍니다. 마지막으로 테스트의 편의성을 들 수 있습니다. spring은 테스트 코드를 작성하는데, 지금까지 보던 코드보다 더욱 깔끔하고 쉬운 테스트 패턴을 제공하고 있습니다. Spring을 사용한 테스트 코드를 다시 한번 알아보도록 하겠습니다.</p>
<p>Spring은 spring-test를 통해 테스트를 구성할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = BookServiceConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBookServiceTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(context).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkBeansWithConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConnectionFactory connectionFactory01 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">        ConnectionFactory connectionFactory02 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactory"</span>);</span><br><span class="line">        assertThat(connectionFactory01).isEqualTo(connectionFactory02);</span><br><span class="line"></span><br><span class="line">        BookService bookService = context.getBean(BookService.class);</span><br><span class="line">        assertThat(bookService).isNotNull();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@RunWith</code>와 <code>@ContextConfiguration</code>을 통해 로드된 <code>application-context</code>를 재사용이 됩니다. 여러개의 테스트코드를 작성할때, 속도를 위해 꼭 사용되어야지 되는 코드입니다.</p>
<h2 id="객체의-생명주기"><a href="#객체의-생명주기" class="headerlink" title="객체의 생명주기"></a>객체의 생명주기</h2><p>spring에서의 객체의 생명 주기는 기본적으로 한번 사용된 객체를 재사용합니다. 테스트 코드를 통해서 이를 확인해보도록 하겠습니다.<br>구성된 코드에 System.out.println 을 이용해서 bookApp 객체의 instance id를 확인해보도록 하겠습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dec <span class="number">23</span>, <span class="number">2017</span> <span class="number">1</span>:<span class="number">23</span>:<span class="number">48</span> PM org.springframework.context.support.AbstractApplicationContext prepareRefresh</span><br><span class="line"><span class="function">INFO: <span class="title">Refreshing</span> <span class="title">org.springframework.context.support.GenericApplicationContext</span>@59<span class="title">f99ea</span>: <span class="title">startup</span> <span class="title">date</span> [<span class="title">Sat</span> <span class="title">Dec</span> 23 13:23:48 <span class="title">KST</span> 2017]; <span class="title">root</span> <span class="title">of</span> <span class="title">context</span> <span class="title">hierarchy</span></span></span><br><span class="line"><span class="function"><span class="title">com.xyzlast.bookstore.ConnectionFactory</span>@4802796<span class="title">d</span></span></span><br><span class="line"><span class="function"><span class="title">com.xyzlast.bookstore.ConnectionFactory</span>@4802796<span class="title">d</span></span></span><br><span class="line"><span class="function"><span class="title">com.xyzlast.bookstore.ConnectionFactory</span>@4802796<span class="title">d</span></span></span><br><span class="line"><span class="function"><span class="title">Dec</span> 23, 2017 1:23:49 <span class="title">PM</span> <span class="title">org.springframework.context.support.AbstractApplicationContext</span> <span class="title">doClose</span></span></span><br></pre></td></tr></table></figure>
<p>보시면 ConnectionFactory의 모든 객체 Id가 동일함을 알 수 있습니다. ApplictionContext에 저장된 객체를 얻을 때, 새로 생성하는 것이 아닌 기존의 객체를 계속해서 사용하는 것을 알 수 있습니다.<br>왜 모든 객체들을 기본적으로 재사용하게 될까요? 기본적으로 spring은 enterprise development framework입니다. enterprise급의 대규모 시스템에서는 객체의 생성/삭제가 많은 부담을 주게 됩니다. 이에 대한 해결 방법으로 spring은 application context가 로드 될 때, 기본 객체들을 모두 생성, 로드 하는 것을 기본으로 하고 있습니다. 물론, 다른 방법역시 가능합니다.</p>
<p>Spring에서의 객체의 생명주기는 scope로 불리고, 다음 4가지로 관리가 가능합니다.</p>
<p>1.singleton<br>2.prototype<br>3.session<br>4.request</p>
<p>singleton은 default 값입니다. scope를 따로 설정하지 않으면 모두 singleton으로 동작합니다. 이는 객체를 static object와 동일하게 사용하게 됩니다.</p>
<p>prototype은 일반적으로 저희가 사용하던 객체의 생성방법과 동일합니다. new 를 통해서 객체를 생성하고, property 값을 모두 설정시킨 후, 그 객체를 넘겨주게 됩니다.</p>
<p>session과 request는 web programming에서 사용되는 scope입니다. 새로운 session이 생성될 때, 새로운 request가 생성이 될때 사용될 수 있는 scope 입니다.</p>
<p>크게는 singleton과 prototype을 이용하면 대부분의 객체 생명주기 관리는 가능합니다. 생명주기선언은 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = BeanDefinition.SCOPE_SINGLETON)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ConnectionFactory <span class="title">connectionFactoryWithSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">        <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">    <span class="keyword">return</span>  connectionFactory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = BeanDefinition.SCOPE_PROTOTYPE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ConnectionFactory <span class="title">connectionFactoryWithProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory(<span class="string">"org.mariadb.jdbc.Driver"</span>,</span><br><span class="line">        <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line">    <span class="keyword">return</span>  connectionFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 생성된 코드에 대한 테스트는 다음과 같이 진행할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkBeanLifeCycle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConnectionFactory singleton01 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactoryWithSingleton"</span>);</span><br><span class="line">    ConnectionFactory singleton02 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactoryWithSingleton"</span>);</span><br><span class="line">    assertThat(singleton01.hashCode()).isEqualTo(singleton02.hashCode());</span><br><span class="line"></span><br><span class="line">    ConnectionFactory proxy01 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactoryWithProxy"</span>);</span><br><span class="line">    ConnectionFactory proxy02 = (ConnectionFactory) context.getBean(<span class="string">"connectionFactoryWithProxy"</span>);</span><br><span class="line">    assertThat(proxy01.hashCode()).isNotEqualTo(proxy02.hashCode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 코드를 확인해보시면 아시겠지만 Factory Pattern에서의 Factory와 동일한 기능을 가지게 되는 것을 알 수 있는데요. <strong>ApplicationContext는 bean의 Map과 Factory를 지원한다.</strong> 라고 할 수 있습니다.<br>spring을 사용하게 되면, 객체들을 new로 새롭게 할당하는 일들이 얼마 없습니다. 아니 new를 안쓰고 만들 수 있어야지 됩니다. 모든 객체 bean들은 spring을 통해서 관리가 되고, bean들간의 데이터 교환을 위한 POJO(Plain Old Java Object)들만 new로 생성되어서 데이터 교환이 되는 것이 일반적인 패턴입니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>이번 장에서는 Spring을 이용한 객체의 관리를 위주로 Simple Application을 작성해봤습니다. 다음 개념들은 반드시 다시 정리해보시는 것이 좋습니다.</p>
<ul>
<li>ApplicationContext : Spring에서 제공하는 bean의 Map/ObjectFactory</li>
<li>property, constructor, init-method를 이용한 객체 초기화 방법</li>
<li>IoC, DIP, DI</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java-DIP-SOLID/">study,java,DIP,SOLID</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/05-02-sample-app-md/"><span>05-02.Sample Application(2) - 테스트/코드평가</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/05-02-sample-app-md/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:47:40.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-2-테스트-코드평가"><a href="#SampleApplication-2-테스트-코드평가" class="headerlink" title="SampleApplication(2) - 테스트/코드평가"></a>SampleApplication(2) - 테스트/코드평가</h1><h2 id="Test를-통한-코드-평가"><a href="#Test를-통한-코드-평가" class="headerlink" title="Test를 통한 코드 평가"></a>Test를 통한 코드 평가</h2><p>올바른 테스트란, 사람이 개입되어서는 안됩니다. 사람이 눈으로 테스트를 확인하는 경우는, 그것을 보지 않는다면 또는 테스트가 너무나 많아져서 테스트의 정보를 확인할 수 없다면 완전히 무용지물이 되어버리고 맙니다. 그리고, 개발을 해보시면 좀더 느끼시지만 하나를 만드니 다른쪽에서 에러가 발생할 수도 있습니다. 마지막으로 CI 환경에서 자동화된 build를 지원할 수가 없습니다.</p>
<p>따라서, 테스트는 확인 가능하나 완전 자동적인 코드로서 구성이 되어야지 됩니다. 테스트는 크게 2가지로 나눌 수 있습니다. 전에 CI에 대해서 간략하게 설명을 할 때, QA 부서에서 담당하기 전 단계라고 할 수 있는 단위 테스트(Unit TEST)와 QA 부서에서 진행하는 통합 테스트가 존재합니다. 잘 만들어진 개발 조직에서, 개발자는 자신의 단위 테스트를 유지하고 관리할 의무를 가지고 있습니다. 그리고 자신의 코드가 단위적으로는 에러가 발생하지 않는다는 결과를 보여줄 수 있는 방법이 있어야지 됩니다. 이를 위해 java에서는 junit이라는 테스트 도구를 배포하고 있고, 이 테스트 코드를 사용하면 자동화 되고, 확인이 가능한 코드로서 사용할 수가 있습니다.</p>
<p>따라서, 기본 folder구조에 왜 <code>src/test</code> 폴더가 존재하는지 알 수 있습니다. 테스트 코드 역시 관리 되어야지 되며, 이를 통해 코드의 변경이 일어났을 때, 그 코드의 문제점을 확인할 수 있어야지 됩니다.</p>
<p>java에서는 <code>JUnit</code>이라는 멋진 테스트 툴이 있습니다. 이 툴에 대해서 한번 알아보도록 하겠습니다.</p>
<p>junit을 사용할 때 기억할 annotation 목록입니다.</p>
<ul>
<li>@Test : Test method를 지정할 때 사용합니다. Test method는 반드시 public에 return type은 void, input 값은 하나도 없는 형태여야지 됩니다.</li>
<li>@Before : Test method를 시작하기 전에 반드시 실행될 method입니다.</li>
<li>@After : Test method를 수행 후, 실행될 method입니다.</li>
<li>@BeforeClass : 전체 테스트 코드 method가 수행되기 전에 실행됩니다. 반드시 public, static type의 method여야지 됩니다.</li>
<li>@AfterClass : 전체 테스트 코드 method가 수행된 후에 실행됩니다. 반드시 public, static type의 method여야지 됩니다.</li>
</ul>
<p>테스트 코드의 annotation을 모두 사용한 테스트 코드입니다. 한번 내용을 확인해보도록 하겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#1. BeforeClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#6. AfterClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#2. Before"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#3. After"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#4. Test01"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#5. Test02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"#6. Test03"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>결과는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#1. BeforeClass</span><br><span class="line">#2. Before</span><br><span class="line">#4. Test01</span><br><span class="line">#3. After</span><br><span class="line">#2. Before</span><br><span class="line">#5. Test02</span><br><span class="line">#3. After</span><br><span class="line">#2. Before</span><br><span class="line">#6. Test03</span><br><span class="line">#3. After</span><br><span class="line">#6. AfterClass</span><br></pre></td></tr></table></figure>
<p>신규 테스트를 추가해보도록 하겠습니다. <code>BookService</code>에서 우클릭 후, <code>GoTo &gt; Test</code>를 통해 <code>BookServiceTest</code>를 만듭니다.<br>그리고, <code>BookService</code>를 테스트 하는 코드를 작성해보도록 하겠습니다.</p>
<p><img src="/images/05/intellij08.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bookService = <span class="keyword">new</span> BookService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Book <span class="title">generateNewBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Book newBook = <span class="keyword">new</span> Book();</span><br><span class="line">        newBook.setName(<span class="string">"newName01"</span>);</span><br><span class="line">        newBook.setAuthor(<span class="string">"newAuthor01"</span>);</span><br><span class="line">        newBook.setComment(<span class="string">"newComment01"</span>);</span><br><span class="line">        newBook.setPublishDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> newBook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Book&gt; allBooks = bookService.getAll();</span><br><span class="line">        <span class="keyword">if</span> (allBooks.isEmpty()) &#123;</span><br><span class="line">            bookService.add(generateNewBook());</span><br><span class="line">            allBooks = bookService.getAll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Book checkBook = allBooks.get(allBooks.size() - <span class="number">1</span>);</span><br><span class="line">        Book getBook = bookService.get(checkBook.getId());</span><br><span class="line">        Assert.assertEquals(checkBook.getId(), getBook.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> preCount = bookService.countAll();</span><br><span class="line">        Book newBook = generateNewBook();</span><br><span class="line">        bookService.add(newBook);</span><br><span class="line">        <span class="keyword">long</span> afterCount = bookService.countAll();</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(<span class="string">"하나 더 추가 되었는지?"</span>, preCount + <span class="number">1</span>, afterCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Book&gt; allBooks = bookService.getAll();</span><br><span class="line">        <span class="keyword">if</span> (allBooks.isEmpty()) &#123;</span><br><span class="line">            bookService.add(generateNewBook());</span><br><span class="line">            allBooks = bookService.getAll();</span><br><span class="line">        &#125;</span><br><span class="line">        Book checkBook = allBooks.get(allBooks.size() - <span class="number">1</span>);</span><br><span class="line">        bookService.delete(checkBook.getId());</span><br><span class="line"></span><br><span class="line">        Book deletedBook = bookService.get(checkBook.getId());</span><br><span class="line">        Assert.assertNull(deletedBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;Book&gt; allBooks = bookService.getAll();</span><br><span class="line">        <span class="keyword">long</span> allCount = bookService.countAll();</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(allBooks.size(), allCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> allCount = bookService.countAll();</span><br><span class="line">        <span class="keyword">if</span> (allCount &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++) &#123;</span><br><span class="line">                bookService.add(generateNewBook());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.assertTrue(bookService.countAll() &gt;= <span class="number">10</span>);</span><br><span class="line">        bookService.deleteAll();</span><br><span class="line">        Assert.assertEquals(bookService.countAll(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>테스트를 돌리는 방법은 IDE에서 실행하는 방법이 있고, <code>gradle</code>을 이용하는 방법이 있습니다. IDE에서는 다음과 같이 실행할 수 있습니다.</p>
<p><img src="/images/05/intellij09.png" alt=""><br><img src="/images/05/intellij10.png" alt=""></p>
<p>그리고, gradle을 통해 다음과 같이 실행할 수 있습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle test</span><br></pre></td></tr></table></figure>
<p><code>build/reports/tests/test</code> 폴더를 확인해보면 다음 파일들을 확인해볼 수 있습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── classes</span><br><span class="line">│   ├── AppTest.html</span><br><span class="line">│   └── BookServiceTest.html</span><br><span class="line">├── css</span><br><span class="line">│   ├── base-style.css</span><br><span class="line">│   └── style.css</span><br><span class="line">├── index.html</span><br><span class="line">├── js</span><br><span class="line">│   └── report.js</span><br><span class="line">└── packages</span><br><span class="line">    └── default-package.html</span><br></pre></td></tr></table></figure>
<p>brower를 열어서 확인하면 다음과 같은 내용을 확인할 수 있습니다.</p>
<p><img src="/images/05/test-report01.png" alt=""></p>
<p>테스트가 정상적으로 다 통과가 된 것을 확인할 수 있습니다. 그런데, 테스트를 다 통과했다고 해서 테스트를 잘 작성했는지 확인을 할 수 있을까요?<br>테스트를 어떻게 하면 잘 작성했다고 할 수 있을까요. 여기에서 <code>Code Coverage</code>라는 개념이 나오게 됩니다.</p>
<p>이제 <code>gradle</code>에서 <code>Code Coverage</code>를 계산하기 위해서 <code>build.gradle</code>을 다음과 같이 변경하도록 하겠습니다. <code>java</code>에서 <code>Code Coverage</code>를 계산하기 위해서는 <code>jacoco</code>를 이용합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'application'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'jacoco'</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.google.guava:guava:23.0'</span></span><br><span class="line">    compile <span class="string">group:</span> <span class="string">'org.mariadb.jdbc'</span>, <span class="string">name:</span> <span class="string">'mariadb-java-client'</span>, <span class="string">version:</span> <span class="string">'2.2.0'</span></span><br><span class="line">    testCompile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">&#125;</span><br><span class="line">jacoco &#123;</span><br><span class="line">    toolVersion = <span class="string">"0.7.9"</span></span><br><span class="line">&#125;</span><br><span class="line">jacocoTestReport &#123;</span><br><span class="line">    reports &#123;</span><br><span class="line">        xml.enabled = <span class="literal">true</span></span><br><span class="line">        csv.enabled = <span class="literal">false</span></span><br><span class="line">        html.enabled= <span class="literal">true</span></span><br><span class="line">        html.destination file(<span class="string">"$&#123;jacoco.reportsDir&#125;/html"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    jacoco &#123;</span><br><span class="line">        append = <span class="literal">false</span></span><br><span class="line">        destinationFile = file(<span class="string">"$buildDir/jacoco/jacoco.exec"</span>)</span><br><span class="line">        classDumpDir = file(<span class="string">"$buildDir/jacoco/classpathdumps"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    reports &#123;</span><br><span class="line">        junitXml.enabled = <span class="literal">true</span></span><br><span class="line">        html.enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ignoreFailures = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">mainClassName = <span class="string">'App'</span></span><br></pre></td></tr></table></figure>
<p>추가된 후, 다음 gradle 명령어를 통해 테스트를 다시 돌립니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean test jacocoTestReport</span><br></pre></td></tr></table></figure>
<p>테스트가 종료된 후, <code>build/reports/jacoco/html</code>을 에서 <code>index.html</code>을 확인하면 다음과 같은 결과들을 볼 수 있습니다.</p>
<p><img src="/images/05/jacoco01.png" alt=""><br><img src="/images/05/jacoco02.png" alt=""><br><img src="/images/05/jacoco03.png" alt=""></p>
<p>테스트 결과를 확인 할 수 있으며, 테스트가 통과되지 않은 코드들을 확인 할 수 있습니다.</p>
<p>Test Coverage를 확인하면 자신의 코드가 어떻게 테스트가 되었는지 확인할 수 있습니다.<br>좋은 테스트를 작성하게 되면, 에러발생상황을 쉽게 시뮬레이션이 가능합니다. 좋은 테스트 코드를 관리해갈 수 있어야지 됩니다.</p>
<h2 id="코드-평가"><a href="#코드-평가" class="headerlink" title="코드 평가"></a>코드 평가</h2><p>이제 작성되어 있는 코드를 평가해보도록 하겠습니다. 코드에 대한 평가는 주로 정적프로그램분석(static program analysis)를 통해서 이루어집니다. 테스트코드의 경우 동적프로그램분석(dynamic program analysis)에 해당됩니다.</p>
<p>java에서 주로 사용되는 정적프로그램분석방법은 다음 3가지를 뽑습니다.</p>
<ul>
<li>PMD</li>
<li>FindBugs</li>
<li>CheckStyle</li>
</ul>
<h3 id="PMD"><a href="#PMD" class="headerlink" title="PMD"></a>PMD</h3><p>정해진 규칙에 따라 소스코드를 검사해주고 이에 대한 결과를 Report 시켜줍니다. PMD는 잠재적인 버그, 사용되지 않는 코드, 너무 복잡한 코드, 중복된 코드를 찾습니다.</p>
<p><code>build.gradle</code>에 다음과 같은 설정을 추가합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'pmd'</span></span><br><span class="line">pmd &#123;</span><br><span class="line">    ignoreFailures = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pmdMain &#123;</span><br><span class="line">    reports &#123;</span><br><span class="line">        xml.destination = file(<span class="string">"$&#123;pmd.reportsDir&#125;/pmd.xml"</span>)</span><br><span class="line">        html.enabled = <span class="literal">true</span></span><br><span class="line">        xml.enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>gradle pmdMain</code>을 통해 <code>PMD</code>결과를 보여줍니다. 지금까지 작성된 코드에서의 PMD Report는 다음과 같은 결과를 보여줍니다.</p>
<p><img src="/images/05/pmd.png" alt=""></p>
<h3 id="FindBugs"><a href="#FindBugs" class="headerlink" title="FindBugs"></a>FindBugs</h3><p>잠재적 버그를 찾습니다. FindBugs의 경우 source code가 아닌 compile된 class파일을 이용해서 버그를 찾아내기 때문에 compile이 반드시 필요합니다.</p>
<p><code>build.gradle</code>에 다음과 같은 설정을 추가해줍니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'findbugs'</span></span><br><span class="line"></span><br><span class="line">findbugs &#123;</span><br><span class="line">    ignoreFailures = <span class="literal">true</span></span><br><span class="line">    toolVersion =<span class="string">'3.0.1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">findbugsMain &#123;</span><br><span class="line">    reports &#123;</span><br><span class="line"><span class="comment">// HTML,XML 둘중 하나의 Report만 작성 가능합니다.</span></span><br><span class="line"><span class="comment">//        xml.enabled = true</span></span><br><span class="line"><span class="comment">//        xml.destination = file("$&#123;findbugs.reportsDir&#125;/findbugs.xml")</span></span><br><span class="line">        html.enabled = <span class="literal">true</span></span><br><span class="line">        html.destination = file(<span class="string">"$&#123;findbugs.reportsDir&#125;/findbugs.html"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>gradle findbugsMain</code>을 통해 FindBugs결과를 볼 수 있습니다. 지금까지 작성된 코드에서의 FindBugs Report는 다음 결과를 보여줍니다.</p>
<p><img src="/images/05/findbugs01.png" alt=""><br><img src="/images/05/findbugs02.png" alt=""></p>
<h3 id="CheckStyle"><a href="#CheckStyle" class="headerlink" title="CheckStyle"></a>CheckStyle</h3><p>CheckStyle은 코딩 패턴을 확인합니다. 버그를 찾는 코드분석이 아닙니다. class의 이름이나 method의 이름, 코드의 길이등을 확인해서 정해진 규칙대로 코드가 작성되었는지를 확인합니다.<br>전에 잠시 소개했었던 <code>secucen-checkstyle.xml</code>이 이를 정의하고 있습니다.<br>사내 Redmine: <code>https://192.168.54.104/attachments/47/secucen-checkstyle.xml</code>에서 다운받을 수 있습니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE module PUBLIC "-//Puppy Crawl//DTD Check Configuration 1.3//EN" "http://www.puppycrawl.com/dtds/configuration_1_3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span> = <span class="string">"Checker"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"charset"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"severity"</span> <span class="attr">value</span>=<span class="string">"warning"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fileExtensions"</span> <span class="attr">value</span>=<span class="string">"java, properties, xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"FileTabCharacter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"eachLine"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"TreeWalker"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"OuterTypeFilename"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"IllegalTokenText"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"STRING_LITERAL, CHAR_LITERAL"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"\\u00(09|0(a|A)|0(c|C)|0(d|D)|22|27|5(C|c))|\\(0(10|11|12|14|15|42|47)|134)"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Consider using special escape sequence instead of octal value or Unicode escaped value."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AvoidEscapedUnicodeCharacters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowEscapesForControlCharacters"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowByTailComment"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowNonPrintableEscapes"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"LineLength"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"max"</span> <span class="attr">value</span>=<span class="string">"120"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignorePattern"</span> <span class="attr">value</span>=<span class="string">"^package.*|^import.*|a href|href|http://|https://|ftp://"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AvoidStarImport"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"excludes"</span> <span class="attr">value</span>=<span class="string">"java.io,java.net,java.lang.Math,org.assertj.core.api.Assertions,org.mockito.Mockito,org.springframework.test.web.servlet.result.MockMvcResultHandlers,org.springframework.test.web.servlet.setup.MockMvcBuilders,org.hamcrest.CoreMatchers,org.junit.Assert,org.springframework.test.web.servlet.result.MockMvcResultMatchers"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowClassImports"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowStaticMemberImports"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"OneTopLevelClass"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"NoLineWrap"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"EmptyBlock"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"option"</span> <span class="attr">value</span>=<span class="string">"TEXT"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"LITERAL_TRY, LITERAL_FINALLY, LITERAL_IF, LITERAL_ELSE, LITERAL_SWITCH"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"NeedBraces"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"RightCurly"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"RightCurlySame"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"LITERAL_TRY, LITERAL_CATCH, LITERAL_FINALLY, LITERAL_IF, LITERAL_ELSE, LITERAL_DO"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"RightCurly"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"RightCurlyAlone"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"option"</span> <span class="attr">value</span>=<span class="string">"alone"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"CLASS_DEF, METHOD_DEF, CTOR_DEF, LITERAL_FOR, LITERAL_WHILE, STATIC_INIT, INSTANCE_INIT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"WhitespaceAround"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowEmptyConstructors"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowEmptyMethods"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowEmptyTypes"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowEmptyLoops"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.notFollowed"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"WhitespaceAround: ''&#123;0&#125;'' is not followed by whitespace. Empty blocks may only be represented as '&#123;&#125;' when not part of a multi-block statement (4.1.3)"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.notPreceded"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"WhitespaceAround: ''&#123;0&#125;'' is not preceded with whitespace."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"OneStatementPerLine"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MultipleVariableDeclarations"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"ArrayTypeStyle"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MissingSwitchDefault"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"FallThrough"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"UpperEll"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"ModifierOrder"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"EmptyLineSeparator"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowNoEmptyLineBetweenFields"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"SeparatorWrap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"SeparatorWrapDot"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"DOT"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"option"</span> <span class="attr">value</span>=<span class="string">"nl"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"SeparatorWrap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"SeparatorWrapComma"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"COMMA"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"option"</span> <span class="attr">value</span>=<span class="string">"EOL"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"PackageName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z]+(\.[a-z][a-z0-9]*)*$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Package name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"TypeName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Type name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MemberName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z][a-z0-9][a-zA-Z0-9]*$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Member name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"ParameterName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z]([a-z0-9][a-zA-Z0-9]*)?$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Parameter name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"CatchParameterName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z]([a-z0-9][a-zA-Z0-9]*)?$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Catch parameter name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"LocalVariableName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"VARIABLE_DEF"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z]([a-z0-9][a-zA-Z0-9]*)?$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Local variable name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"ClassTypeParameterName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"(^[A-Z][0-9]?)$|([A-Z][a-zA-Z0-9]*[T]$)"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Class type name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MethodTypeParameterName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"(^[A-Z][0-9]?)$|([A-Z][a-zA-Z0-9]*[T]$)"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Method type name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"InterfaceTypeParameterName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"(^[A-Z][0-9]?)$|([A-Z][a-zA-Z0-9]*[T]$)"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Interface type name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"NoFinalizer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"GenericWhitespace"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.followed"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"GenericWhitespace ''&#123;0&#125;'' is followed by whitespace."</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.preceded"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"GenericWhitespace ''&#123;0&#125;'' is preceded with whitespace."</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.illegalFollow"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"GenericWhitespace ''&#123;0&#125;'' should followed by whitespace."</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"ws.notPreceded"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"GenericWhitespace ''&#123;0&#125;'' is not preceded with whitespace."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"Indentation"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;module name="CommentsIndentation"/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AbbreviationAsWordInName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ignoreFinal"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowedAbbreviationLength"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"OverloadMethodsDeclarationOrder"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"VariableDeclarationUsageDistance"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MethodParamPad"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"ParenPad"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"OperatorWrap"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"option"</span> <span class="attr">value</span>=<span class="string">"NL"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"BAND, BOR, BSR, BXOR, DIV, EQUAL, GE, GT, LAND, LE, LITERAL_INSTANCEOF, LOR, LT, MINUS, MOD, NOT_EQUAL, PLUS, QUESTION, SL, SR, STAR, METHOD_REF "</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AnnotationLocation"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"AnnotationLocationMostCases"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"CLASS_DEF, INTERFACE_DEF, ENUM_DEF, METHOD_DEF, CTOR_DEF"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AnnotationLocation"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"AnnotationLocationVariables"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tokens"</span> <span class="attr">value</span>=<span class="string">"VARIABLE_DEF"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"allowSamelineMultipleAnnotations"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"NonEmptyAtclauseDescription"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"JavadocTagContinuationIndentation"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"SummaryJavadoc"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forbiddenSummaryFragments"</span> <span class="attr">value</span>=<span class="string">"^@return the *|^This method returns |^A [&#123;]@code [a-zA-Z0-9]+[&#125;]( is a )"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"JavadocParagraph"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"AtclauseOrder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"tagOrder"</span> <span class="attr">value</span>=<span class="string">"@param, @return, @throws, @deprecated"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">value</span>=<span class="string">"CLASS_DEF, INTERFACE_DEF, ENUM_DEF, METHOD_DEF, CTOR_DEF, VARIABLE_DEF"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"JavadocType"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"severity"</span> <span class="attr">value</span>=<span class="string">"ignore"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"JavadocMethod"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"severity"</span> <span class="attr">value</span>=<span class="string">"ignore"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"JavadocVariable"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"severity"</span> <span class="attr">value</span>=<span class="string">"ignore"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"MethodName"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"^[a-z][a-z0-9][a-zA-Z0-9_]*$"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.invalidPattern"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">value</span>=<span class="string">"Method name ''&#123;0&#125;'' must match pattern ''&#123;1&#125;''."</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span> <span class="attr">name</span>=<span class="string">"EmptyCatchBlock"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionVariableName"</span> <span class="attr">value</span>=<span class="string">"expected"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>이제 <code>build.gradle</code>에 checkstyle을 추가할 차례입니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'checkstyle'</span></span><br><span class="line"></span><br><span class="line">checkstyle &#123;</span><br><span class="line">    toolVersion = <span class="string">'8.2'</span></span><br><span class="line">    ignoreFailures = <span class="literal">true</span></span><br><span class="line">    configFile = rootProject.file(<span class="string">"secucen-checkstyle.xml"</span>)</span><br><span class="line">    reportsDir = file(<span class="string">"$&#123;buildDir&#125;/checkstyle-output"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>gradle checkstyleMain</code>을 통해 결과를 확인할 수 있습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :checkstyleMain</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/App.java:<span class="number">8</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">136</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">7</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">124</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">10</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">12</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">124</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">24</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">127</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">27</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">29</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">137</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">43</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">131</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">46</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">58</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">121</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">61</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">63</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">124</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">83</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">124</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">112</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">118</span>: Distance between variable 'count' declaration and its first usage is <span class="number">4</span>, but allowed <span class="number">3</span>.  Consider making that variable final <span class="keyword">if</span> you still need to store its value <span class="keyword">in</span> advance (before method calls that might have side effects on the original value). [VariableDeclarationUsageDistance]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">127</span>: Line is longer than <span class="number">120</span> characters (found <span class="number">121</span>). [LineLength]</span><br><span class="line">[ant:checkstyle] [WARN] /Users/secucen/dev/code/secucen-study/step01/src/main/java/BookService.java:<span class="number">130</span>:<span class="number">55</span>: '(' is preceded with whitespace. [MethodParamPad]</span><br></pre></td></tr></table></figure>
<p>꽤나 많은 것들이 걸리는 것을 볼 수 있습니다.</p>
<h2 id="SonarQube"><a href="#SonarQube" class="headerlink" title="SonarQube"></a>SonarQube</h2><p>이런 정적분석툴 결과를 수집하고, 관리하는 application입니다. 이 툴은 특별한 설명이 없이 바로 실행해서 확인해보도록 하겠습니다.<br>SonarQube를 통해서 추가합니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'org.sonarqube'</span></span><br><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">"org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:2.5"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그리고 <code>gradle.properties</code>파일을 추가합니다. <code>gradle.properties</code>파일은 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemProp.sonar.host.url=http://192.168.94.18:9000</span><br><span class="line">systemProp.sonar.login=cbb2cca03f69cac6bea892228129433bb0240bb6</span><br><span class="line">systemProp.sonar.projectKey=sampleApp01-이름을넣어주세요</span><br></pre></td></tr></table></figure>
<p><code>gradle clean sonarqube</code>을 통해서 실행합니다. <code>http://192.168.94.18:9000</code>에서 결과를 확인해볼 수 있습니다. 자신의 Project의 이름을 보고 확인해보시면 좋습니다.</p>
<p><img src="/images/05/sonarqube.png" alt=""></p>
<p>정적 코드 분석에 대해서 한번 정리해보도록 하겠습니다.</p>
<table>
<thead>
<tr>
<th></th>
<th>FingBugs</th>
<th>PMD</th>
<th>CheckStyle</th>
</tr>
</thead>
<tbody>
<tr>
<td>목적</td>
<td>잠재적버그찾기(java파일이 아닌 class파일 이용)</td>
<td>잠재적인 문제들, 버그가능성이 있는 부분들, 사용되지 않았거나 최적화되지 않은 코드를 검색</td>
<td>java code를 style.xml을 이용해서 규칙 위반 여부를 체크</td>
</tr>
<tr>
<td>장점</td>
<td>실제 결함을 잘 찾아줌<br>정확성이 높음<br>속도가 빠름</td>
<td>실제 결함을 찾는 경우가 많음<br>나쁜 패턴을 잘 찾습니다.</td>
<td>정해진 코딩 규약에 위반되는 것을 찾아줍니다.</td>
</tr>
<tr>
<td>단점</td>
<td>compile된 class를 이용하기 때문에 build과정이 필수적입니다.</td>
<td>속도가 늦습니다.</td>
<td>실제 버그를 찾는 과정이 아닙니다.</td>
</tr>
<tr>
<td>규칙수</td>
<td>408</td>
<td>234</td>
<td>xml에 따라 다름</td>
</tr>
</tbody>
</table>
<p>이 3가지 모두를 다 사용할 수 있는 것이 좋습니다. 자신의 문제를 객관적으로 확인해볼 수 있습니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java/">study,java</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/05-01-sample-app-md/"><span>05-01.SampleApplication(1) - 초난감 Project</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/05-01-sample-app-md/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:46:33.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-1-초난감-프로젝트"><a href="#SampleApplication-1-초난감-프로젝트" class="headerlink" title="SampleApplication(1) - 초난감 프로젝트"></a>SampleApplication(1) - 초난감 프로젝트</h1><p>이 장의 제목은 Toby의 Spring Framework에서 붙인 이름을 그대로 표절해봤습니다. 매우 큰 문제를 가진 간단한 프로그램이 뛰어난 확장성과 처음의 너저분한 코드에서 점차 깔끔하게 구성 되어가는 코드로 점차 변경되어가는 것을 볼 수 있을겁니다.<br>먼저, 간단한 application입니다. bookStore라고 하나의 Project를 만들고, books 라는 table에 대한 CRUD와 count를 하는 application을 간단히 작성해보도록 하겠습니다.</p>
<h2 id="개발-환경-준비-amp-초기화"><a href="#개발-환경-준비-amp-초기화" class="headerlink" title="개발 환경 준비 &amp; 초기화"></a>개발 환경 준비 &amp; 초기화</h2><h3 id="Docker를-이용한-Database-준비"><a href="#Docker를-이용한-Database-준비" class="headerlink" title="Docker를 이용한 Database 준비"></a>Docker를 이용한 Database 준비</h3><p>먼저, 대상이 되는 database를 준비하도록 하겠습니다. docker를 이용해서 제가 준비를 해두었습니다. docker cmd를 통해서 다음 명령어를 실행합니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">4306</span>:<span class="number">3306</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">94</span>.<span class="number">18</span>:<span class="number">15000</span>/study-container:<span class="number">002</span> mysqld_safe</span><br></pre></td></tr></table></figure>
<p>를 실행하면 docker container에서 실행되어 있을것입니다.<br>그 후, host machine으로 돌아와서(CTRL + P, CTRL + Q) 다음 <code>cmd</code>를 통해 db에 정상적으로 붙을 수 있는지 확인하도록 합니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -pqwer12#$ -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P4306 bookstore</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use bookstore;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select * from books;</span><br><span class="line">+----+-----------+-----------+---------------------+-------------------+</span><br><span class="line">| id | name      | author    | publishDate         | comment           |</span><br><span class="line">+----+-----------+-----------+---------------------+-------------------+</span><br><span class="line">|  <span class="number">1</span> | TEST BOOK | 나야나     | <span class="number">2017</span>-<span class="number">12</span>-<span class="number">18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | 이건 뭘까요.       |</span><br><span class="line">+----+-----------+-----------+---------------------+-------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="gradle을-이용한-project-초기화-작업-진행"><a href="#gradle을-이용한-project-초기화-작업-진행" class="headerlink" title="gradle을 이용한 project 초기화 작업 진행"></a>gradle을 이용한 project 초기화 작업 진행</h3><p>이제 db가 준비된 것을 확인하였으니 시작할 folder를 지정하고 다음의 gradle 명령어를 넣어 시작합니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle init --<span class="built_in">type</span> java-application</span><br></pre></td></tr></table></figure>
<p>몇개의 process들이 진행되고, 다음 실행 결과가 나오면 일단 종료된겁니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Starting a Gradle Daemon (subsequent builds will be faster)</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> <span class="number">3</span>s</span><br><span class="line"><span class="number">2</span> actionable tasks: <span class="number">2</span> executed</span><br></pre></td></tr></table></figure>
<p>만들어진 folder 구조는 다음과 같습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   └── java</span><br><span class="line">    │       └── App.java</span><br><span class="line">    └── test</span><br><span class="line">        └── java</span><br><span class="line">            └── AppTest.java</span><br></pre></td></tr></table></figure>
<p>폴더 기반으로 먼저 설명을 드린다면, 다음과 같습니다.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>gradle</td>
<td>gradle 실행 파일이 위치한 folder입니다. 신경쓰지 않으셔도 됩니다.</td>
</tr>
<tr>
<td>src/main</td>
<td>실제 코드가 들어갈 folder입니다. 우리가 주로 작성할 코드가 이곳에 위치합니다</td>
</tr>
<tr>
<td>src/test</td>
<td>테스트 코드가 들어갈 folder입니다. 작성된 코드가 정상적으로 동작하는지를 확인하기 위한 코드 작성 구역입니다.</td>
</tr>
<tr>
<td>build.gradle</td>
<td>build가 선언된 파일입니다.</td>
</tr>
</tbody>
</table>
<p>이 구조는 잘 알아두어야지 됩니다. 지금 java 개발에서 이 folder구조가 아닌 구조로 만약 개발이 되어있다면 그 project는 기본적으로 원칙을 지키지 않은 상태입니다. 현 상태에서는 이 구조가 표준입니다.</p>
<p>다음은 <code>build.gradle</code> 파일을 알아보도록 하겠습니다. 안드로이드 개발을 해보신 분들은 자주 보시던 구조일겁니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'java'</span></span><br><span class="line">apply <span class="string">plugin:</span> <span class="string">'application'</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.google.guava:guava:23.0'</span></span><br><span class="line">    testCompile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">&#125;</span><br><span class="line">mainClassName = <span class="string">'App'</span></span><br></pre></td></tr></table></figure>
<p>먼저 정의된 것은 <code>plugin</code>입니다. 이 build에서 어떤 것을 사용할지를 정의합니다. <code>java</code>이며, <code>application</code>을 정의하고 있습니다. 이 구조는 <code>jar</code>형태로 실행될 수 있는 java application을 개발할 때 사용되는 구조입니다.</p>
<p>repositories는 dependency library들을 다운 받을 위치를 지정합니다. <code>jcenter</code>를 기본값으로 사용하고 있으며, 다음 값들을 갖는 것이 일반적입니다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jcenter()</span><br><span class="line">mavenCentral()</span><br><span class="line">mavenLocal()</span><br><span class="line">maven &#123;</span><br><span class="line"><span class="symbol">    url:</span> <span class="string">'http://repo.mycompany.com/maven2'</span>,</span><br><span class="line"><span class="symbol">    credentials:</span> &#123;</span><br><span class="line"><span class="symbol">        username:</span> <span class="string">'user'</span>,</span><br><span class="line"><span class="symbol">        password:</span> <span class="string">'password'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dependencies는 dependency library들을 위치하는 곳입니다. 접미어가 붙어있는데 다음과 같은 의미를 갖습니다.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>compile</td>
<td>Compile시에 사용되는 library입니다. 이는 <code>src/main</code>에서 사용되는 library 들을 의미합니다.</td>
</tr>
<tr>
<td>testCompile</td>
<td>Test Compile시에 사용되는 library입니다. 이는 <code>src/test</code>에서 사용되는 library들을 의미합니다.</td>
</tr>
</tbody>
</table>
<h3 id="Project-Import-with-IntelliJ"><a href="#Project-Import-with-IntelliJ" class="headerlink" title="Project Import with IntelliJ"></a>Project Import with IntelliJ</h3><p>IntelliJ에서 이제 project를 import해서 개발을 할 수 있는 준비를 시작합니다.</p>
<p>실행 후, <code>Import Project</code>를 통해 <code>build.gradle</code>이 있는 folder를 import 시킵니다.</p>
<p><img src="/images/05/intellij01.png" alt=""></p>
<p><img src="/images/05/intellij02.png" alt=""></p>
<p><img src="/images/05/intellij03.png" alt=""></p>
<p>선택할때, 다른 option은 크게 신경쓸 필요는 없지만, 다음 Option은 볼 필요가 있습니다.</p>
<table>
<thead>
<tr>
<th>menu</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Use default gradle wrapper(recommended)</td>
<td>gradle wrapper를 사용합니다.</td>
</tr>
<tr>
<td>Use gradle wrapper task configuration</td>
<td>gradle wrapper를 이용해서 그 안의 세부 task를 이용합니다.</td>
</tr>
<tr>
<td>Use local gradle distribution</td>
<td>local PC에 설치된 gradle을 이용합니다.</td>
</tr>
</tbody>
</table>
<p>recommanded가 첫번째로 되어 있지만, 저는 3번째 option을 사용하는 것을 추천합니다. android project의 경우에는 첫번째 option을 사용하는 것이 좋습니다. gradle이 버젼업이 되어가면서 groovy 문법의 version이 바뀐 것 때문에 구 버젼에서 만들어진 <code>build.gradle</code>이 local machine에서 동작하지 않는 경우가 발생할 수 있습니다. 그래서 gradle은 자신이 만들어질 때 사용한 gradle의 wrapper version을 project에 같이 배포하는 것으로 버젼의 문제를 해결할 수 있습니다. 단, 지금의 경우 local PC에 설치된 gradle이 속도가 가장 빠르기 때문에 이럴때는 그냥 local PC의 gradle을 사용하는 것을 권장합니다.</p>
<p>프로젝트가 로드되면 다음과 같은 화면을 볼 수 있습니다.</p>
<p><img src="/images/05/intellij04.png" alt=""><br><img src="/images/05/intellij05.png" alt=""></p>
<p>이제 intelliJ에서 coding을 할 준비가 모두 완료되었습니다.</p>
<h3 id="외부-Library의-추가"><a href="#외부-Library의-추가" class="headerlink" title="외부 Library의 추가"></a>외부 Library의 추가</h3><p>docker에 의해 제공된 DB는 mariaDb입니다. mariadb의 JDBC connector를 구하기 위해서 <code>http://mvnrepository.com/</code>에서 mariadb을 검색해서 dependency library를 검색합니다.</p>
<p><img src="/images/05/maven01.png" alt=""></p>
<p><code>Gradle</code> 텝으로 가서 copy해서 <code>build.gradle</code>에 추가합니다.<br>추가 후, 우측 dock에 위치한 <code>Gradle</code>에서 <code>refresh all Gradle projects</code>를 실행시킵니다.</p>
<p><img src="/images/05/intellij06.png" alt=""></p>
<p>실행시키면 아래 <code>External Libraries</code>에 보면 <code>org.mariadb.jdbc:mariadb-java-client:2.2.0</code>이 추가된 것을 볼 수 있습니다.</p>
<p><img src="/images/05/intellij07.png" alt=""></p>
<h3 id="초난감-프로젝트의-시작"><a href="#초난감-프로젝트의-시작" class="headerlink" title="초난감 프로젝트의 시작"></a>초난감 프로젝트의 시작</h3><p>먼저 우리의 프로젝트는 다음 일을 할 수 있는 객체를 만들것입니다.</p>
<ul>
<li>books table에 CRUD가 가능하도록 한다.</li>
<li>books에 총 몇개의 row가 있는지 확인 할 수 있어야지 된다.</li>
<li>books table을 clear 시킬 수 있도록 한다.</li>
</ul>
<p>간단히 Book 객체를 만들겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Date publishDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getComment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setComment</span><span class="params">(String comment)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.comment = comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getPublishDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> publishDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPublishDate</span><span class="params">(Date publishDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.publishDate = publishDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기본적인 <code>VO</code> 형태로 <code>getter/setter</code>가 있는 단순한 코드형태입니다. 이제 이 객체를 이용한 객체를 만들어보도록 하겠습니다.</p>
<p>이제 여기에 CRUD, countAll, deleteAll method를 구현해보도록 하겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>;</span><br><span class="line">        Class.forName(<span class="string">"org.mariadb.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        Connection conn = DriverManager.getConnection (url, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line"></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"insert books(name, author, publishDate, comment) values(?, ?, ?, ?)"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>;</span><br><span class="line">        Class.forName(<span class="string">"org.mariadb.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        Connection conn = DriverManager.getConnection (url, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line"></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ? where id = ?"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getId());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> bookId)</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://127.0.0.1:4306/bookstore"</span>;</span><br><span class="line">        Class.forName(<span class="string">"org.mariadb.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        Connection conn = DriverManager.getConnection (url, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line"></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"delete from books where id = ?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, bookId);</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">get</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://localhost:4306/bookstore"</span>;</span><br><span class="line">        Class.forName(<span class="string">"org.mariadb.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        Connection conn = DriverManager.getConnection (url, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line"></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select id, name, author, publishDate, comment from books where id=?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, id);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">        Book book = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (!rs.next()) &#123;</span><br><span class="line">            book = <span class="keyword">new</span> Book();</span><br><span class="line">            book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">            book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">            book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">            java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://localhost:4306/bookstore"</span>;</span><br><span class="line">        Class.forName(<span class="string">"org.mariadb.jdbc.Driver"</span>).newInstance();</span><br><span class="line">        Connection conn = DriverManager.getConnection (url, <span class="string">"root"</span>, <span class="string">"qwer12#$"</span>);</span><br><span class="line"></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select count(*) from books"</span>);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        rs.next();</span><br><span class="line"></span><br><span class="line">        Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>작성된 코드를 한번 확인해보시길 바랍니다. 이제 이 코드가 정상적으로 돌아가는지 어떻게 하면 확인할 수 있을까요?</p>
<p>먼저 위의 코드의 가장 큰 문제점은 <em>실행하기 전까지는 정상적으로 코드를 작성했는지 확인할 수가 없다</em> 입니다.<br>실행하기 위해서 <code>BookApp.java</code>를 추가해서 다음과 같은 코드를 작성했습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException, InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        BookService bookService = <span class="keyword">new</span> BookService();</span><br><span class="line">        System.out.println(bookService.countAll());</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(<span class="number">1</span>);</span><br><span class="line">        book.setName(<span class="string">"ChangedBookName"</span>);</span><br><span class="line">        book.setAuthor(<span class="string">"나야나"</span>);</span><br><span class="line">        book.setComment(<span class="string">"이건 뭘까요."</span>);</span><br><span class="line">        book.setPublishDate(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        bookService.update(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이런 식으로 모든 코드를 실행하는 코드를 만들어주면, 이것을 우리는 어떻게하면 확인을 할 수 있을까요. 이 방법은 매우 많은 사람들이 사용하고 있는 방법입니다. 그렇지만, 많은 사람들이 사용하고 있다고 해서 좋은 방법은 아닌거지요. 실행해봐야지 아는 것은 절대로 좋은 코드가 될 수 없습니다. 실행 후, 확인하는 것은 최종 제품테스트에서나 하는 것이지, 개발중에 하는 것은 아닙니다. 우리는 우리의 코드를 잘 만들어서 테스트 할 필요성이 있습니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>개발환경을 꾸미고, 간단한 코드를 작성해보았습니다.<br>이제 다음은 만들어진 코드를 테스트하고, 평가하는 방법에 대해서 알아보도록 하겠습니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java/">study,java</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/04-intro-spring-md/"><span>04.Spring Framework 소개</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/04-intro-spring-md/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:45:14.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="Spring-Framework-소개"><a href="#Spring-Framework-소개" class="headerlink" title="Spring Framework 소개"></a>Spring Framework 소개</h1><p>Spring Framework에 대한 소개와 왜 Spring을 써야지 되는지에 대한 당위성을 간단한 application을 작성하면서 알아보도록 하겠습니다.<br>application을 작성하면서 놀랍게 줄어드는 코드 양과 Spring의 강력함을 느끼실 수 있으실겁니다.</p>
<h2 id="Framework란"><a href="#Framework란" class="headerlink" title="Framework란?"></a>Framework란?</h2><p>먼저 Framework의 정의를 해야지 됩니다. 각자 개인마다 Framework에 대한 정의가 다를거라고 생각이 되지만, 가장 혼란스러운 개념이 Library와 Framework라고 생각이 됩니다.<br>Libray와 Framework는 매우 유사한 점을 가지고 있습니다. 우선적으로 많은 기능들을 별도의 file, class에서 제공하고 있습니다. 그리고 이를 묶어놓은 것들을 외부 Library 또는 외부 Framework라고 합니다.</p>
<p>그럼 이 둘의 차이는 무엇일까요?</p>
<p>Library는 특정 목적을 위한 function, class들을 모아놓은 꾸러미입니다. 우리는 Library를 특정 목적을 위해서 가져다가 사용할 수 있습니다. 예를 들어 JSON을 객체로 변경시키기 위해서 Jackson과 같은 Json Library를 가져다가 사용할 수 있습니다.<br>Framework를 application의 실행 flow를 변경시킵니다. Framework를 이용하게 된다면, 우리의 Application의 실행은 모두 Framework에 의해서 동작하게 되며 우리의 코드는 Framework가 가져다가 사용하는 일부의 part가 되게 됩니다.<br>한마디로 Framework란 자동차의 뼈대와 같이 Application의 기본 구조를 제공하고 있으며, 개발자들은 구현하고자하는 기능구현에 집중할 수 있도록 해주는 소프트웨어라고 할 수 있습니다.</p>
<h2 id="Spring-Framework-란"><a href="#Spring-Framework-란" class="headerlink" title="Spring Framework 란?"></a>Spring Framework 란?</h2><p>Spring Framework 란 엔터프라이즈급 자바 어플리케이션 개발에서 필요로 하는 경량형 어플리케이션 프레임워크입니다.<br>스프링 프레임워크는 J2EE[Java 2 Enterprise Edition] 에서 제공하는 대부분의 기능을 지원하기 때문에, J2EE를 대체하는 프레임워크로 자리잡고 있습니다. Spring이라는 이름의 기원은 기존 EJB로 대표되는 Enterprise Framework의 시대를 겨울(winter)로 정의하고, 이젠 봄(Spring)이 왔다 라는 의미로 지어졌습니다. 시작은 한권의 책의 예제에서부터 시작이 되었습니다.</p>
<p>Spring Framework는 다음과 같은 특징을 가지고 있습니다.</p>
<ul>
<li>경량 컨테이너입니다. (light container) 스프링은 객체를 담고 있는 컨테이너로써 자바 객체의 생성과 소멸과 같은 라이프사이클을 관리하고, 언제든 필요한 객체를 가져다 사용할 수 있도록 도와주는 기능을 가지고 있습니다.</li>
<li>DI[Dependency Injection] 패턴 지원을 지원합니다. (DI : 의존성 주입) 객체들간의 의존 관계를 쉽게 설정할 수 있습니다. 그로인해 객체들간의 느슨한 결합을 유지하고 직접 의존하고 있는 객체를 굳이 생성하거나 검색할 필요성이 없이 구성이 가능합니다. 이는 IoC(Inversion of Controller)로 이야기되기도 합니다. 정확히는 DI로 인한 IoC를 가능하게 하는 Framework라고 할 수 있습니다.</li>
<li>AOP[Aspect Oriented Programming] 지원 (AOP : 측면 지향 프로그래밍 )합니다. AOP는 문제를 바라보는 관점을 기준으로 프로그래밍하는 기법이다. 이는 문제를 해결하기 위한 핵심 관심 사항과 전체에 적용되는 공통관심 사항을 기준으로 프로그래밍 함으로써 공통 모듈을 여러 코드에 쉽게 적용할 수 있도록 한다. 스프링은 자체적으로 프록시 기반의 AOP를 지원하므로 트랜잭션이나 로깅, 보안등과 같이 여러 모듈에서 공통적으로 필요하지만 실제모듈핵심은 아닌 기능들을 분리하여 각 모듈에 적용할 수 있도록 한다.</li>
</ul>
<p>Spring Framework는 위의 3가지의 특징을 가진 Framework입니다. 또한, 부가적인 기능으로서 ruby on rails에서 표방한 non shared status web 개발을 지원하는 @MVC 역시 지원하고 있습니다.</p>
<p><img src="/images/04/spring.png" alt=""></p>
<p>Spring Framework의 기본구조입니다. 위에서 말한 3가지의 특징은 Spring Core와 Spring AOP, Spring Context에 의하여 구성이 되어 있습니다. 나머지 ORM, WEB, DAO, WEB MVC의 경우에는 부가적 기능이라고 볼 수 있습니다.</p>
<p>이런식으로만 적어두면, Spring이 과연 무엇을 하는 녀석인지를 알 수가 없습니다. 그래서 간단한 예제를 통해서 Spring을 통해서 점점 진화가 되어가는 코드의 변화를 보면서 Spring을 익혀보도록 하겠습니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study/">study</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/03-personalEnv/"><span>03.개인 개발 환경 구축</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/03-personalEnv/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:44:11.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="개인개발환경-구성"><a href="#개인개발환경-구성" class="headerlink" title="개인개발환경 구성"></a>개인개발환경 구성</h1><p>이 장에서는 개인적으로 추천하는 개발 툴들을 소개하고자 합니다.<br>java 개발환경은 모두가 설정할 줄 안다고 가정을 하고, IDE는 IntelliJ community version을 기반으로 설명을 하도록 하겠습니다.</p>
<h2 id="gradle"><a href="#gradle" class="headerlink" title="gradle"></a>gradle</h2><p>gradle은 안드로이드 개발을 할때 많이 보신분들이 있겠지만, build tool입니다.<br>java, c#, c++ 등 모든 언어를 compile 할 수 있는 build tool을 목표로 하고 있습니다. java에서는 maven이 가장 많이 사용되고 있는 build tool이지만,<br>개인적으로는 gradle이 더 좋은 tool이라고 확신하는 편입니다.</p>
<p>Spring Source 역시 gradle을 기본 build tool로 사용하고 있으며, multi-project build에 강점을 갖습니다. 다양한 plugin 역시 장점입니다.</p>
<h3 id="build란"><a href="#build란" class="headerlink" title="build란?"></a>build란?</h3><p><em>build라는 것이 무엇인가</em>에 대한 정의에 따라서 build tool이 해야지 되는 일들은 달라집니다.<br>기본적인 build의 정의는 다음과 같이 말할 수 있습니다.</p>
<p><em>소스 코드를 동작하는 독립적인 소프트웨어 산출물로 만드는 과정</em></p>
<p>매우 단순하게 정의가 가능한 이 과정은 막상 해보게 되면 다음과 같은 문제를 같이 생각해봐야지 됩니다.</p>
<ul>
<li>의존관계를 갖는 외부 library와의 버젼 관리 문제</li>
<li>개발자 1명이 아닌, 개발팀이 동시에 환경을 구축이 가능한 수 있는지</li>
</ul>
<p>그리고, 작은 의미의 build가 아닌 좀 더 확대해보면 다음과 같이 말할 수 있습니다.</p>
<p><em>소스 코드를 동작하는 독립적인 소프트웨어 산출물로 만들어 배포하는 과정</em></p>
<p>이렇게 생각해보면 build는 compile, test, publish를 모두 포함하는 범위입니다. 이러한 build를 도와주는 tool을 build tool이라고 합니다.<br>java에서는 maven, gradle이 사실상의 정의(de-factor)로 사용되고 있습니다.</p>
<p>java에서의 주요 build tool은 다음것들이 있습니다.</p>
<h4 id="Apache-Ant"><a href="#Apache-Ant" class="headerlink" title="Apache Ant"></a>Apache Ant</h4><ul>
<li>java로 구현된 project의 build에 적합함</li>
<li>file의 copy, command의 실행에 중점</li>
<li>java project의 경우, classpath와 javac 명령어의    조합으로 compile 하는    것을 목적</li>
<li>build.xml 또는 ant.properties 파일을 통해서 build를 정의</li>
</ul>
<h4 id="Apache-Maven"><a href="#Apache-Maven" class="headerlink" title="Apache Maven"></a>Apache Maven</h4><ul>
<li>ant와 비슷</li>
<li>goal, phase를 통해 project의 life cycle을 정형화 하고 관리</li>
<li>pom.xml 을 통해 build를 정의</li>
<li>dependency library들의 버젼별 관리 가능</li>
<li>documentation 및 relase note에 대한 정의</li>
</ul>
<h4 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h4><ul>
<li>ant + maven + groovy</li>
<li>plug in의 조합으로 project의 life cycle을 정형화하고 관리</li>
<li>maven의 goal로 지정되어 있는 정적인 결합이 아닌, groovy언어로 programing이 가능한 build의 정의가 가능</li>
</ul>
<h2 id="git-flow"><a href="#git-flow" class="headerlink" title="git flow"></a>git flow</h2><p><em>git</em>을 이용한 개발시에 있어서 개발 process를 강제하는 command tool입니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git flow [command]</span><br></pre></td></tr></table></figure>
<p>를 통해서 실행을 하며 branch -&gt; commit -&gt; develop merge -&gt; master merge를 강제하게 됩니다. git을 <em>잘</em> 사용하게 돕는 tool로 생각하면 좋습니다.<br>다음은 git flow의 예시입니다.</p>
<h3 id="신규-Issue의-진행"><a href="#신규-Issue의-진행" class="headerlink" title="신규 Issue의 진행"></a>신규 Issue의 진행</h3><ul>
<li>redmine에서 신규 개발 process issue 80번을 확인</li>
<li><code>git flow feature start is80</code>을 통해 신규 branch 에서 작업 진행</li>
<li><code>git flow feature finish is80</code>을 통해 branch 작업 완료</li>
<li><code>git checkout master</code>를 통해 신규 master branch 이동</li>
<li><code>git pull</code>을 통해 최신 master update</li>
<li><code>git merge develop</code>를 통해 개발한 내용 merge</li>
<li><code>git push</code>를 통한 최신 소스 push</li>
<li><code>git checkout develop</code>를 통해 다시 개발 branch로 이동</li>
</ul>
<h3 id="신규-Release-진행"><a href="#신규-Release-진행" class="headerlink" title="신규 Release 진행"></a>신규 Release 진행</h3><ul>
<li>master, develop간의 sync 확인</li>
<li><code>git flow release start [[version-name]]</code>을 통해 신규 release 시작</li>
<li><code>git flow release finish [[version-name]]</code>을 통해 release tag 를 붙여서 release를 작성</li>
<li><code>git push origin [[version-name]]</code>을 통해 tag된 release를 remote origin으로 push</li>
</ul>
<p>자세한 설명은 <a href="https://danielkummer.github.io/git-flow-cheatsheet/index.ko_KR.html" target="_blank" rel="noopener">https://danielkummer.github.io/git-flow-cheatsheet/index.ko_KR.html</a> 를 통해 볼 수 있습니다. 많은 분들이 사용하셨으면 하는 tool입니다.</p>
<h2 id="git-kraken"><a href="#git-kraken" class="headerlink" title="git kraken"></a>git kraken</h2><p>git의 개발 흐름을 한눈에 볼 수 있도록 도와주는 tool입니다. commit 등에도 유용하게 사용이 가능하지만, 개인적으론 git은 terminal 환경에서 사용하는 것이 더 좋고, 개발흐름을 보는데 많은 도움을 줄 수 있습니다.</p>
<p><img src="/images/03/gitkraken.png" alt=""></p>
<h2 id="PMD-codestyle-FindBug"><a href="#PMD-codestyle-FindBug" class="headerlink" title="PMD, codestyle, FindBug"></a>PMD, codestyle, FindBug</h2><p>PMD, codestyle, FindBug은 자바를 위한 정적 분석 도구입니다. 개발자들은 표준 코드에 부합하고 좋은 코드를 제공하기 위해 사용하는 것이 좋습니다. 팀 리더와 품질 보증 직원들은 코드 검토(Code Review)의 특성을 바꾸기 위해 사용하는데, 이 도구들은 코드 검토로부터 발견된 기계적이고 문법 적인 점검을 취약점으로 변경하게 됩니다.</p>
<p>자신들의 코드를 끊임없이 평가를 받고 그에 대한 feedback을 받을 수 있다면, 개발자들의 실력은 좀 더 나아질 수 있을 것입니다.</p>
<h2 id="sonarQube"><a href="#sonarQube" class="headerlink" title="sonarQube"></a>sonarQube</h2><p>PMD, codestyle, FindBug에서 평가된 내용에 대한 통계 및 처리 방법에 대한 Report를 제공합니다. 이러한 Report를 볼 수 있습니다. (<a href="http://192.168.94.18:9000/dashboard?id=fds-v2" target="_blank" rel="noopener">http://192.168.94.18:9000/dashboard?id=fds-v2</a>)</p>
<p><img src="/images/04/sonarqube.png" alt=""></p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>교육중에 DB는 Docker image를 통해 제공하도록 하겠습니다. 제 IP를 기준으로 image를 다운 받을 수 있도록 하겠습니다. docker에 대해서 사용을 해보시고, 어떤 식으로 사용이 가능할지를 한번 고민해보는 자리가 되었으면 좋겠습니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>앞으로는 실제적인 개발코드 및 과제가 나갈 예정입니다. 아래 SW의 설치를 해둔 환경을 준비해주시길 바랍니다.</p>
<ul>
<li>IntelliJ Community Version</li>
<li>Gradle</li>
<li>JAVA 8</li>
<li>DOCKER</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study/">study</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/02-developEnd/"><span>02.팀 단위의 개발 환경</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/02-developEnd/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:42:56.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="팀-단위의-개발-환경"><a href="#팀-단위의-개발-환경" class="headerlink" title="팀 단위의 개발 환경"></a>팀 단위의 개발 환경</h1><p>개발을 할때는 환경이 매우 중요합니다. 개발 환경을 팀의 관점으로 볼때는 단순히 업무 흐름만을 보는것은 너무 옛날 이야기가 되었습니다.<br>이제 팀 단위의 개발환경에서 거의 필수가 된 항목들은 다음과 같습니다.</p>
<ul>
<li>코드 관리 시스템</li>
<li>이슈 관리 시스템</li>
<li>자동 빌드 시스템</li>
<li>Code Review 시스템</li>
<li>자동 배포 시스템</li>
<li>로컬 개발 서버(DB 포함) - 개발자 PC</li>
<li>테스트 서버 (DB 포함)</li>
<li>배포 서버 (DB 포함)</li>
</ul>
<p>각 시스템이 유동적으로 연결되어 하나의 프로젝트가 완성이 되는 것이 일반적입니다.<br>먼저, 간단한 예를 들어보기로 하겠습니다. 여기 신입 개발자 A군과 고참 개발자 B양이 있습니다.</p>
<blockquote>
<p>B양은 이슈 관리 시스템을 통해서 자신의 팀에 주어진 일들을 확인합니다. 그리고 간단한 팀 미팅을 통해 서로간에 지금 어제 어떤 일을 했고, 오늘 어떤 일을 할 것이며, 오늘 이슈 사항이 무엇이 있는지를 파악합니다. 파악한 후, 추가로 들어온 일이 있는 경우에 그 사항을 이슈 관리시스템이 등록 또는 수정을 하고 담당자를 A군으로 지정합니다.</p>
<p>A군은 이슈 관리 시스템을 통해서 자신에게 주어진 일을 확인합니다. 그리고, 이미 분석된 업무이고, 바로 개발을 들어가게 됩니다. 먼저 코드 관리 시스템에서 소스를 최신의 것으로 Update 받습니다. 받은 Source의 History를 파악하고, DB schema의 변경사항이 있는 경우, 자신의 개발 환경에 반영을 하고 코딩을 시작합니다.</p>
<p>A군은 코딩을 열심히 해서 일을 마쳤습니다. 그리고, 소스를 코드관리 시스템에 commit을 진행합니다. 소스관리 시스템은 commit된 코드가 있음을 관리자에게 알립니다.</p>
<p>B양은 A군의 코딩 내용을 보고 Code Review를 진행합니다. 맘에 안들면 불러다가, 또는 email로 깨고, reject 시킵니다. 그렇게 되면 이 코드는 반영되지 않게 됩니다.</p>
<p>A군은 다시 코딩을 합니다. 지적 받은 사항에 대해서 다시 고치고, 다시 commit을 합니다.</p>
<p>B양은 A군의 코드를 review하면서 흐뭇해하면서 코드를 accept합니다. accept된 코드는 이제 자동 빌드 시스템으로 넘어갑니다.</p>
<p>A군은 자신이 한 일에 대해서 이슈 관리 시스템에 일의 진행정도를 알리고, 완료를 시킵니다. 물론 약간의 문서 작업도 진행합니다.</p>
<p>자동빌드 시스템은 열심히 코드를 build하고, 자동화된 test code를 모두 실행하고 그 결과를 팀원 전체에게 email로 알립니다.</p>
<p>test code가 모두 완료되면 build한 결과를 테스트 서버에 배포하게 됩니다. 이제 테스트 서버를 통해서 QC 팀들이 개발팀의 결과를 검증하게 됩니다.</p>
<p>QA 팀이 검증을 모두 마쳤습니다. 자동 배포 시스템을 통해서 실제 동작하는 서비스로 배포하게 됩니다. (모두들 수고하셨습니다.)</p>
</blockquote>
<p>이러한 과정을 거치게 되는 것이 일반적인 개발회사에서의 흐름입니다. 그리고 계속되는 통합 과정을 통해, 코드의 품질을 계속해서 높이는 과정을 하게 됩니다. 그러나… 불행히도 저희 회사는 저기 위에 있는 시스템중 반도 존재하지 않습니다.</p>
<p>실질적인 예가 아닌, 이제 좀더 본격적인 설명에 들어가보도록 하겠습니다.</p>
<h2 id="코드-관리-시스템-Repository"><a href="#코드-관리-시스템-Repository" class="headerlink" title="코드 관리 시스템 (Repository)"></a>코드 관리 시스템 (Repository)</h2><p>주로 사용되는 것은 svn과 요즘 인기를 끌고 있는 git가 있습니다. 기능으로는 code의 중앙 저장소 및 source 변경에 대한 history 관리 기능과 sync, merge 등이 있습니다.<br>저희가 자주 사용하고 있지만, 조금은 다르게 사용하고 있는것 같긴 합니다. 주 기능은 code의 저장입니다. 그렇지만, 그 이상으로 중요하다고 생각되는 기능은 code의 history입니다. 어느날 갑자기 code를 받아보니 변경사항이 있었고, 그 내용이 왜, 그리고 무엇이 변경된것인지 모른다면 예전에 code를 usb같은것으로 카피해서 주는것과 차이가 없습니다. 코드를 변경했으면, 그 code를 왜 변경했는지에 대한 log를 적어주는 것이 이 시스템을 보다 더 잘 쓰는 방법입니다.</p>
<h2 id="이슈-관리-시스템"><a href="#이슈-관리-시스템" class="headerlink" title="이슈 관리 시스템"></a>이슈 관리 시스템</h2><p>많은 이슈 관리 시스템이 존재합니다. 대표적인것으로 무료로 배포되는 것들은 trac, jtrac, redmine, bugzillar 등이 있으며 상용은 jira가 있습니다. 상용으로 판매되는 jira는 정말 좋습니다. 개인적으론 구매를 해서 사용해보고 싶은 욕심이 무척 많이 듭니다. ㅠㅠ<br>코드 관리시스템이 코드에 대한 중앙 집중형 관리라면, 이슈 관리 시스템은 왜 그 코드를 작성하게 되었는지. 우리가 프로젝트를 완료하기 위해서는 앞으로 어떤 일들을 해야지 되는지. 그리고 지금까지 우리가 어떤 일을 해왔는지에 대한 “일, 작업, Issue, Task”에 대한 기록을 남기는 장소입니다. 이슈 관리 시스템은 코드 관리 시스템과 연동되어 코드의 변경사항이 어떤 이슈와 관련이 있는지까지 같이 보여줄 수 있습니다. 또한, 대부분의 코드 관리 시스템은 wiki라는 문서 작업 공간을 같이 제공합니다. wiki를 통해 서로간에 공유할 수 있는 내용을 기록하는 것이 가능합니다.</p>
<p><img src="images/02/wiki.jpg" alt=""></p>
<h2 id="자동-빌드-시스템-자동-배포-시스템"><a href="#자동-빌드-시스템-자동-배포-시스템" class="headerlink" title="자동 빌드 시스템, 자동 배포 시스템"></a>자동 빌드 시스템, 자동 배포 시스템</h2><p>이 두개의 시스템은 거의 하나로 만들어져서 사용됩니다. 이를 CI 시스템이라고 하며, hudson, jenkins와 jetBrains 사의 TeamCity가 유명합니다. CI가 CI 가 하는 일은 소스 관리 시스템과 연결되어 commit된 소스가 있는 경우, 자신이 다운받아 build 후, test code를 실행하고 그 결과를 report로 남기는 일을 반복합니다.또한 build 결과 또는 수동으로 실서버 또는 개발서버에 배포를 할 수 있기때문에 신속하고 중지 되지 않는 통합을 가능하게 하고 있습니다.</p>
<p><img src="images/02/jenkins.png" alt=""><br><img src="images/02/jenkins2.png" alt=""></p>
<p>CI에 대하여 조금 더 알아보도록 하겠습니다.</p>
<p>다음은 CI의 기본 동작 Process를 나타내고 있습니다.</p>
<ul>
<li>Commit source code : 개발자가 자신의 code 를 commit 한다</li>
<li>Unit Test : CI가 코드에 포함된 Unit Test code를 실행한다.</li>
<li>CPM ( Continiuous Performance Management) : Unit Test 결과를 기록하고, Unit test의 실행 시간등을 기록한다.</li>
<li>License check : 만약 코드 안에 상용 library등이 포함되어 있다면, license에 대한 check를 진행한다.</li>
<li>Build : Build 및 추가 파일 복사 작업 진행</li>
<li>Deploy : Test 환경으로의 배포 ( &gt; QI 영역)</li>
</ul>
<p><img src="/images/02/ci.png" alt=""></p>
<h2 id="Code-Review-System"><a href="#Code-Review-System" class="headerlink" title="Code Review System"></a>Code Review System</h2><p>약간은 옵션적인 시스템이지만, 많은 기업들이 채용하고 있는중인 Code Review System입니다. Code Review란 간단히 사용자의 자신의 Code를 코드 관리 시스템에 Commit을 할때, 중간 단계를 하나 거치게 하는 것입니다. 그 중간단계에서 상임 개발자들이 그 코드를 평가하고, 원활히 변경된 경우에 그 코드를 코드 관리 시스템에 반영하는 절차를 추가한 시스템입니다. CodeCollaboration 이 대표적 시스템입니다.</p>
<p><img src="/images/02/codeReview.png" alt=""></p>
<h2 id="로컬-개발-환경"><a href="#로컬-개발-환경" class="headerlink" title="로컬 개발 환경"></a>로컬 개발 환경</h2><p>개발자들은 자신의 로컬 개발 환경을 갖춰야지 됩니다.</p>
<p>그리고, 개발환경의 구축은 다음과 같은 문제가 발생하게 됩니다. 다양한 인프라를 동시에 사용해야지 되는 프로젝트를 행하게 될때입니다.</p>
<p><strong>STEP01. 이제 시작입니다</strong><br><img src="/images/02/step01.jpg" alt=""><br><strong>STEP02. 약간 커졌습니다. 이쯤이야</strong><br><img src="/images/02/step02.jpg" alt=""><br><strong>STEP03. 아라라. 힘들어집니다</strong><br><img src="/images/02/step03.jpg" alt=""><br><strong>STEP04. 이건 좀… 무리가…</strong><br><img src="/images/02/step04.jpg" alt=""></p>
<p>그렇다면 개발서버에 모든 것을 설치해두고 사용하면 어떨까요.<br>개발서버에 모든 것을 설치하고, 개발자들이 각각 붙어서 작업하는 경우 많은 것들이 해결되게 됩니다. 그런데, 이 역시 문제를 가지고 있습니다.</p>
<ul>
<li>버젼이 변경되는 경우에 서버의 DB Schema의 변경이 이루어지게 된다.</li>
<li>네트워크가 끊기는 경우, 개발 역시 STOP.(원격지에서의 개발이 힘듬)</li>
<li>하나의 개발자의 행동이 다른 개발자들에게 동시에 영향을 줄 수 있음(DB 값의 변경, Memory Server의 restart)</li>
</ul>
<p>이러한 문제가 발생되기 때문에 개발서버를 사용하는 방법은 이제 구시대적 방법이라고 할 수 있습니다. 실제로 조금 개발에 대해서 잘 나간다는 회사들은 대부분 개발서버를 통해서 개발하는 방법을 버리고 있는 것이 사실입니다. 그럼 어떤 방법을 사용할까요.</p>
<p>첫번째는 가상머신입니다.<br>가상머신을 배포해서 가상머신과 로컬머신간의 네트워크 연결을 통해서 사용하는 방법이 있습니다.</p>
<p>이는 매우 좋은 해결책이 될 수 있습니다. 버젼별 가상머신을 관리하면, 유지보수에도 많은 도움이 될 수 있으며 가상머신의 snapshot 기능을 이용하면 DB의 특정 상태로도 restore가 가능하게 되는 많은 장점들을 가지고 있습니다.</p>
<p>그런데, 이 방법의 최대 단점은 용량입니다. 윈도우 머신의 경우, 조금 설치해서 서버를 올리면 60기가는 우스운 용량이 나오게 됩니다. 그리고 memory를 많이 사용하기 때문에 performance 역시 떨어지게 되는 것이 사실입니다.</p>
<p>두번째, 아니 이제 정답을 찾아가게 되면 docker를 이용하는 방법입니다.<br>Docker image에 위 환경을 만들어두고, 그 환경을 이용해서 다들 같이 개발을 하는 것이 일반적입니다. Docker image에 변경이 생길 사항이 생기거나 Docker에 들어있는 DB내용에 변경이 생기게 되면, 그 변경을 image에 반영할지를 개발자들끼리 결정을 하고, 그 변경이 반영된 image를 다시 배포하는 식으로 서로간의 개발단의 구성을 완벽하게 맞추어 개발을 진행합니다. Docker에 대해서는 개별 공부가 좀 더 필요할 것 같습니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>개발환경은 <em>팀단위 개발환경</em>, <em>개인 개발환경</em>으로 나눌수 있습니다.<br><em>팀단위의 개발환경</em>은 개발프로세스에 따라 시스템적으로 지원이 되는 것이 일반적입니다. 이는 사내의 문화로 사용이 발전이 가능한 것으로 서로간에 논의해가야지 될 문제입니다.<br><em>개인 개발환경</em> 역시 팀에서 어떤 개발 프로세스로 진행할지에 따라 선택되는 방법의 차이가 있습니다. 개인적으로는 Docker 또는 가상서버를 통한 개발환경이 개발자들에게 도움이 될 것이라고 생각하는 편입니다. 이 부분에 대해서는 많은 논의가 필요할 것 같습니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study/">study</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/02/01/01-intro/"><span>01.intro</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/01/01-intro/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-01T03:40:57.000Z">
          2018-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="기술의-발전-amp-Application의-구조-변화"><a href="#기술의-발전-amp-Application의-구조-변화" class="headerlink" title="기술의 발전 &amp; Application의 구조 변화"></a>기술의 발전 &amp; Application의 구조 변화</h1><p>IT 기술은 다양한 분야를 가지고 있습니다. 기본적으로 정보에 대한 CRUD(create/read/update/delete) 로 구성되는 것이 일반적입니다.<br>단순 DB Row정보에 대한 CRUD로 이해하지 마시고, 정보의 <strong>생성/변경/삭제/읽기</strong>로 생각하시는 것이 좋습니다.</p>
<h2 id="초기-Stand-alone"><a href="#초기-Stand-alone" class="headerlink" title="초기 Stand alone"></a>초기 Stand alone</h2><p>웹 기술이 아닙니다. VB나 사내의 CS Application 형태로 구성되어 있습니다.<br>예전 윈도우즈에서 보여지고 있는 ODBC 연결이 그 흔적중 하나입니다.</p>
<p><img src="/images/01/odbcmodel.gif" alt=""></p>
<h2 id="2-Tier-초기-WWW-2006년"><a href="#2-Tier-초기-WWW-2006년" class="headerlink" title="2 Tier - 초기 WWW (~ 2006년)"></a>2 Tier - 초기 WWW (~ 2006년)</h2><p>Web 기술이 폭발적으로 발전하던 시기입니다. RDBMS의 발전으로 인하여 DB에 따른 Dynamic Web이 발전되게 됩니다. 이 Dynamic Web 기술에 대한 다양한 변형 기술들을 가지고 오게 됩니다.</p>
<p><img src="/images/01/image7.png" alt=""></p>
<h3 id="asp의-폭발적인-발전"><a href="#asp의-폭발적인-발전" class="headerlink" title="asp의 폭발적인 발전"></a>asp의 폭발적인 발전</h3><p>기존 개발자들의 70%정도를 차지하고 있던 visual basic 개발자들을 모두 web 개발자로 만들어주는 asp와 iis가 처음 선을 보이게 됩니다. 기존 visual basic 개발자들은 모두 db와 db를 표현하는 방식에 대해서 경험이 풍부한 사람들이였습니다. 그 개발자들을 모두 web 개발자로 만드는 엄청난 일을 MS가 성공하게 됩니다. 지금보면 참 문제가 많은 개발방법으로 개발하게 되지만, 그 당시에는 최고의 기술이였으며 누구나 쉽게 웹 프로그래밍에 접근할 수 있다는 점이 가장 큰 장점이였습니다.</p>
<h3 id="php의-발전-및-apache-httpd의-확장"><a href="#php의-발전-및-apache-httpd의-확장" class="headerlink" title="php의 발전 및 apache httpd의 확장"></a>php의 발전 및 apache httpd의 확장</h3><p>기존 standalone 서버에서 주로 사용되던 apache httpd를 이용한 dynamic web programming이 대두되게 됩니다. php는 asp의 장점을 흡수하고, 보다 쉬운 표현 방법을 제시합니다. 그리고 LAMP 라는 환경을 제시하기 때문에, 기업은 새로운 x86 windows server를 구매하는 것이 아닌 공짜로 web을 서비스할 수 있다는 점에서 기존 asp 시장을 잠식하기 시작합니다. 또한 linux 서버환경의 폭발적인 증가로 인하여 서버 환경이 기존 UNIX에서 linux 계열로 발전하게 된 계기가 됩니다.</p>
<h3 id="servlet과-asp-net의-발전"><a href="#servlet과-asp-net의-발전" class="headerlink" title="servlet과 asp .net의 발전"></a>servlet과 asp .net의 발전</h3><p>asp와 php로 인하여 dynamic web application이 엄청난 발전을 하게 됩니다. 하지만 asp와 php의 경우 언어의 특성상 큰 약점을 가지고 있습니다. page단위로 동작하게 되기 때문에, 현대적 프로그래밍 기법인 OOP를 사용할 수 없습니다. (방법은 있으나, 매우 괴악한 방법입니다.;) 점점 application이 거대화되어가면서 코드의 재 사용성 및 유지보수의 약점을 극복하기 위해서 asp와 php에 가려서 잠시 존재감을 잊어가고 있던 java와 .net이 다시 등장하게 됩니다.<br>두 언어는 RDBMS를 표현하는데 있어서 최선(?)의 방식을 가지고 있었으며, vm 기술의 발전으로 memory 및 performance에 강점을 가지고 있었기 때문에, 기존의 web 개발 시장을 빠르게 잠식해나가기 시작합니다.</p>
<h3 id="fat-client의-발전"><a href="#fat-client의-발전" class="headerlink" title="fat client의 발전"></a>fat client의 발전</h3><p>servlet과 asp .net의 발전은 RDBMS와 dynamic web application간의 여러 문제를 모두 해결해준것같지만 사용자들에게 다양한 경험을 보여주기 위한 View를 제공하는데에 있어서, 기존의 HTML만은 한계를 가지고 있었다. 동영상과 같은 멀티미디어를 포함하기에는 기존의 HTML이 지원하지 않는 부분이 너무나 많은 영역들이 있었기 때문입니다. 멀티미디어에 대한 지원을 강화하기 위해서 나온 첫 기술이 micromedia의 Flash입니다. Flash는 멀티미디어의 지원뿐 아니라, 웹을 보다 더 아름답게 만드는데 큰 공헌을 하게 됩니다. Flash의 대성공으로 MS는 asp로 마련했던 서버 시장에 심각한 타격을 입게 됩니다. 그래서 자사의 IIS + .NET Framework 기술로 동작하는 silverlight를 출시하기에 이릅니다. 이러한 멀티 미디어의 지원과 더불어, RDBMS에 특화된 fat client들이 나오게 되는데, PowerBuilder가 대표적입니다. 우리들에게는 <code>X-Client</code>, <code>X-Window</code>와 같은 이름들로 알려진것들이 많습니다.</p>
<p>fat client의 발전은 기존 servlet과 asp .net 기술과 충돌을 일으키게 됩니다. 단순히 servlet과 asp .net을 fat client의 container로 이용하게 되고 모든 로직을 fat client에서 처리하게 되는 개발 방법이 한 때 유행하게 됩니다.</p>
<h2 id="3-tier-N-tier-Cloud-시기-2006년"><a href="#3-tier-N-tier-Cloud-시기-2006년" class="headerlink" title="3 tier, N tier, Cloud 시기 (2006년 ~ )"></a>3 tier, N tier, Cloud 시기 (2006년 ~ )</h2><p>2 tier 가 발전한 형태입니다. 다양한 요구사항으로 인하여 기존 2 tier system의 확장을 통한 여러 시스템간의 결합으로 최종적으로는 enterprise system으로의 진화, 발전되었습니다. 기존 2 tier system에서는 해결할 수 없는 기술적 이슈들이 발생하게 됩니다. 다양한 시스템들이 나오게 되고 그 시스템들간의 상호 통신에 의하여 기존 2 tier 에서 n tier로 계속되는 발전이 이루어지게 됩니다.</p>
<p><img src="/images/01/3tier.svg" alt=""></p>
<h3 id="script-language의-발전"><a href="#script-language의-발전" class="headerlink" title="script language의 발전"></a>script language의 발전</h3><p>기존 .net과 java와는 다른 언어들이 발전하게 됩니다. 기존의 asp와 php가 OOP적 성격을 갖지 못한 단점을 해결하고 OOP적 장점과 개발의 편의성을 극대화한 script language가 발전하게 됩니다. python, ruby가 대두되기 시작하지요. 이 언어들은 기존의 객체 지향적인 특징과 asp, php와 같은 script 적 성격을 모두 갖게 됩니다. 개발의 속도, 변화 가능성에 대한 열린 대응을 토대로 이와 같은 script language가 계속된 발전을 하게 됩니다. 해외의 많은 시스템들이 하부 tier의 경우에는 ruby, python으로 개발된 것을 지금도 자주 볼 수 있습니다.</p>
<p>최근에는 hot하다고 할 수 있는 node.js가 script 언어중 가장 인기가 좋습니다.</p>
<h3 id="web-service의-개발"><a href="#web-service의-개발" class="headerlink" title="web service의 개발"></a>web service의 개발</h3><p>n tier system의 발전은 web service가 없었다면 불가능하다고 할 정도로 web service는 n tier system에 깊이 관여되어 있습니다. web service는 기존의 tier를 종적으로나 횡적으로 모두 확장을 시키는 가장 결정적인 역활을 하게 되는 계기가 되었습니다. “Service로서의 Web”에 대한 개념은 수많은 파생적 개념을 만들어 내고, 기술적 발전을 가지고 왔습니다. 기존에는 SOAP을 기반으로 한 web service가 주로 사용되었으나, 지금은 client(javascript) 등에서의 호출 문제로 인하여 xmlrpc의 경량화된 버젼인 REST를 주로 사용하고 있습니다. 이 REST에 대해서는 다시 한번 설명할 기회를 갖도록 하겠습니다.</p>
<h3 id="MVC의-발전"><a href="#MVC의-발전" class="headerlink" title="MVC의 발전"></a>MVC의 발전</h3><p>기존의 웹의 개발은 단순히 DB의 결과값을 웹에 표현하는 방식이였습니다. 대부분의 Business Logic은 DB에서 가지고 있고, 그 Business Logic을 web에 표현하는 방식이 대부분이였지요. 이렇게 된 가장 큰 이유중 하나는 웹으로 개발을 한 내용은 웹에 너무나 밀착되어있는 프로그램이라서, Business Logic만의 테스트가 거의 불가능하다는 것에서 시작되었습니다. 그렇지만, n tier system으로 발전해나가면서 tier만의 중복된 Business Logic을 정리 및 관리하는데 있어서 기존 프로그래밍 언어로 하고자 하는 욕구가 계속해서 발전되어 갑니다. DB Query 중심의 개발은 필연적인 중복코드와 로직의 누수가 발생하기 마련이니까요.</p>
<p>이때, ruby를 기반으로 한 ruby on rails가 발표됩니다. rails framework라고도 불리우는 이 framework는 기존의 web 개발 방법을 완전히 바꿔놓게 됩니다. 사용자에게 보여지는 영역인 View, Http response/request를 처리하는 Controller 마지막으로 Domain의 Business Logic을 처리하는 Model로 완벽한 영역을 분리할 수 있음을 ruby on rails는 보여주게 됩니다. 이러한 장점은 각 영역을 개발자들이 테스트를 해볼 수 있고, 영역에 대한 전문화를 분리시킬 수 있기 때문에 단숨에 웹 개발의 주도적 방법으로 대두되었습니다. java에서는 struct2가, .net에서는 asp .net mvc가 기존 ruby on rails의 사상을 반영한 MVC web framework입니다.</p>
<p>개발자는 지금 MVC를 중요하게 봐야지 됩니다. MVC 개발 방법은 웹뿐 아니라, 모든 application에 적용되어 있는 상황이고 각 영역에 대한 테스트를 통해서 자신의 코드의 완벽성을 스스로 검증할 수 있는 기회를 가지게 되었습니다. 에러에 대한 명확한 정의가 가능하게 되었으며, 에러가 발생했을때의 장애 처리와 같은 새로운 프로세스 정립 역시 MVC의 확립으로 가능하게 되었습니다. 이 부분은 지금까지는 개발자가 아닌, 기획이나 의사결정자들의 손에 있던 부분이였지만, 지금은 개발자들이 제시하는 방법을 선택하는 방향으로 전환이 된 상태입니다.</p>
<h3 id="mobile-기기의-발전-및-확산"><a href="#mobile-기기의-발전-및-확산" class="headerlink" title="mobile 기기의 발전 및 확산"></a>mobile 기기의 발전 및 확산</h3><p>기존 n tier system의 발전은 획적 확장에 해당된다면 mobile 기기의 발전 및 확산은 종적 확장에 해당됩니다.기존까지 있던 web application의 대상은 모두 PC의 browser를 대상으로 하고 있었습니다. PC를 기반으로 하고 있기 때문에 PC의 특정 browser만을 target으로 하고 개발이 가능해졌지요. 그렇지만, iPhone을 시작으로 한 mobile 기기의 발전은 이러한 생각을 모두 바꾸어놓게됩니다. 누구나 가지고 다니는 mobile 기기는 언제 어디에서나 접근이 가능한 특징을 가지고 있습니다. 이는 기존보다 많은 접속을 만들어 내고, 모든 device에서 동일하게 보여야지 된다는 문제를 가지고 오게 됩니다. 그리고, mobile device의 빈약한 시스템 자원과 기존 windows system과 다른 OS 환경으로 인하여 HTML의 표준화에 대한 요구 사항이 높아지게 됩니다.</p>
<h3 id="fat-client의-쇠퇴와-HTML5의-대두"><a href="#fat-client의-쇠퇴와-HTML5의-대두" class="headerlink" title="fat client의 쇠퇴와 HTML5의 대두"></a>fat client의 쇠퇴와 HTML5의 대두</h3><p>기존 flash와 silverlight와 같은 fat client가 mobile device에서 정상적으로 동작하지 않는 문제가 발생하게 됩니다. 이는 기존 PC에서도 windows-IE 환경 이외에서도 계속 지적되던 문제였지만, 본격적인 문제로서 국내에서는 대두되기 시작한 것은 바로 mobile 기기의 확산때문입니다. 기존 HTML에서 지원되지 않던 multimedia에 대한 지원을 비롯하여 animation과 websocket등의 표준화로 인하여 기존 flash와 silverlight가 설 자리가 없어지기 시작합니다. 지금 fat client는 flash만을 제외하고 거의 사장되어가는 분위기입니다. Flash의 경우에도 HTML5의 확산 전까지 잠시의 대체제로서의 의미 이외에는 퇴색해가는 것이 현실입니다. 기존 Flex 개발자들이 설 자리가 많이 없어지고 있지요.</p>
<h3 id="Big-data와-Cloud-의-대두"><a href="#Big-data와-Cloud-의-대두" class="headerlink" title="Big data와 Cloud 의 대두"></a>Big data와 Cloud 의 대두</h3><p>끊임없이 이야기가 나오고 있는 Big data와 Cloud는 mobile 기기의 발전 및 확산과 기존 web system의 오랜 발전으로 인하여 나온 기술이라고 할 수 있습니다. 기존의 RDBMS에서는 처리를 할 수 없을 정도의 데이터가 이제는 수집이 된 상태이고, 이 데이터들을 어떻게 분석을 해야지 될지. 이 데이터들을 어떻게 활용을 해야지 될지. 그리고 많은 mobile 기기에서 동시 다발적으로 들어오는 데이터를 어떻게 해야지 될지에 대한 물음에서 Big Data와 Cloud를 활용하는 방법을 찾아보는것이 방법일것 같습니다. 이러한 Big Data를 저장하기 위한 방법으로 cassandra, mongoDB, 등이 있으며 Big Data를 처리하기 위한 방법으로 Hadoop이 대두되게 됩니다. 또한 Cloud 시장은 아직 춘추전국의 시대와 같이 복잡한 상황이며, 시장 1위인 amazon의 AWS, MS의 Azure, Google의 Google Cloud Platform등이 경쟁을 하고 있습니다.</p>
<h2 id="개발자가-익혀야지-될-기술"><a href="#개발자가-익혀야지-될-기술" class="headerlink" title="개발자가 익혀야지 될 기술"></a>개발자가 익혀야지 될 기술</h2><h3 id="language-Java-Javascript"><a href="#language-Java-Javascript" class="headerlink" title="language - Java, Javascript"></a>language - Java, Javascript</h3><p>웹쪽 개발에 있어서 backend는 java, frontend는 javascript로 구성되는 것은 아주 일반적입니다. 근간에는 backend쪽도 node.js를 이용해서 frontend와 backend의 언어쪽 기술을 동일하게 들고가는 경우도 많습니다. 요즘은 Javascript의 시대라는 말이 나올정도로 javascript의 인기가 좋은 편입니다. 개발을 이제 시작하는 분들이 있다면 javascript도 꽤나 추천하고 싶은 언어입니다. 웹을 하기 위해서는 어차피 javascript를 해야지만 하니까요.</p>
<h3 id="Backend-Framework-Spring-Java-Express-node-js-Ko-node-js-python-django"><a href="#Backend-Framework-Spring-Java-Express-node-js-Ko-node-js-python-django" class="headerlink" title="Backend Framework - Spring(Java), Express(node.js), Ko(node.js), python(django)"></a>Backend Framework - Spring(Java), Express(node.js), Ko(node.js), python(django)</h3><p>언어가 정해지면, 그 언어를 이용해서 처음부터 열심히 만드는 것이 아닙니다. 많은 천재들이 만들어둔 Framework를 이용하는 것이 일반적입니다. 웹 개발에 있어서 Java측에서는 Spring Framework, node.js에서는 Express와 Ko가 주로 사용됩니다. Framework의 사용법을 익힌다는 것은 Framework의 사상을 이해하는 것이 필요합니다.</p>
<h3 id="Frontend-Framework-ReactJs-AngularJs-Angular2-Vue-js"><a href="#Frontend-Framework-ReactJs-AngularJs-Angular2-Vue-js" class="headerlink" title="Frontend Framework - ReactJs, AngularJs, Angular2, Vue.js"></a>Frontend Framework - ReactJs, AngularJs, Angular2, Vue.js</h3><p>Frontend분야의 발전은 놀라울 정도입니다. 지금 인기가 좋은 Frontend Framework의 경우에는 다음 것들 ReactJs, AngularJs, Angular2, Vue.js가 있습니다. 이 중 하나이상은 익혀두는 것이 좋습니다. 개인적으로는 Vue.js/React.js를 추천합니다.</p>
<h3 id="Data-Storage-Database-Big-Data-No-SQL-Memory-Db"><a href="#Data-Storage-Database-Big-Data-No-SQL-Memory-Db" class="headerlink" title="Data Storage - Database, Big-Data, No-SQL, Memory-Db"></a>Data Storage - Database, Big-Data, No-SQL, Memory-Db</h3><p>Database는 고전적인 이야기이긴 하지만, 여전히 중요한 분야입니다. 기존의 RDBMS뿐 아니라 다른 DB역시 필요합니다. memory db의 일종인 Redis는 이제 서비스를 운영하는 곳이라면 사용하지 않는 곳이 없을정도로 대중적인 인프라중 하나입니다. 또한 NO-SQL 진영에서의 MongoDb나 Big Data 부분에서의 Hadoop 역시 중요합니다. 어떤 분야에 대해서 공부를 할 것인지에 대해서는 많은 세미나를 가보는 것도 좋고, 다른 분야에 대한 관심을 계속해서 갖는 것이 필요합니다.</p>
<h3 id="HTTP-HTTP2"><a href="#HTTP-HTTP2" class="headerlink" title="HTTP, HTTP2"></a>HTTP, HTTP2</h3><p>HTTP는 계속해서 발전되어가면서 지금은 HTTP2의 시대가 오고 있습니다. 웹의 기초가 되는 HTTP가 어떻게 동작하고 있는지에 대한 공부는 계속해서 필요합니다. 그리고 HTTP2가 이제 상용화가 되고 있는 시점이기 때문에, 이에 대한 개발 방법의 변화등도 따라가야지 됩니다. 언제까지 옛날 기술에 계속해서 매몰되어갈 필요는 없습니다.</p>
<h3 id="Modeling"><a href="#Modeling" class="headerlink" title="Modeling"></a>Modeling</h3><p>Modeling은 소위 말하는 ‘업무분석’ 과정입니다. 업무를 분석하고 분석한 업무를 programming language로 구현 가능한 형태로 추상화를 시키는 과정을 의미합니다. 개발자의 생각의 방향은 학교에서 자주 들은 Divide &amp; conquer 입니다. 작게 나누고, 하나하나 해결해나가고. 그 해결한 조그마한 것들을 다시 붙이는 작업들이 필요합니다.</p>
<p>Machine Learning에 있어서도 역시 Modeling은 가장 중요한 일중 하나가 되어 있습니다. <strong>실 상황을 우리가 생각하는 공학적인 분야로 이동시키는 것</strong> 이것이 Modeling의 본질이 됩니다.</p>
<h3 id="개발-방법론"><a href="#개발-방법론" class="headerlink" title="개발 방법론"></a>개발 방법론</h3><p>개발 방법론은 Agile을 기반으로 한 scrum, kanban 등이 인기를 끌고 있습니다. 개발만을 중심으로 생각한다면 TDD(Test Driven Development)가 있습니다. TOP-DOWN 방식으로 진행이 된다면 그에 따르면 좋겠지만, 그것이 안된다면 자신이 자기만의 개발 패턴을 만들기 위해서라도 간단한 이론등을 아는 것이 좋습니다.</p>
<h3 id="Design-pattern"><a href="#Design-pattern" class="headerlink" title="Design pattern"></a>Design pattern</h3><p>개발 방법론과 매우 유사한 분야입니다. 개발을 할때, 코드를 최적화 하는 패턴들이 존재합니다. 패턴을 익히는 것보다는 패턴을 이용해서 개발자들끼리의 의사소통이 가능해져야지 됩니다. 개발자들끼리 사용하는 약어가 되는 경우가 꽤나 많습니다. 그리고 책을 통해서 학습을 할때도 유용합니다.</p>
<h3 id="단위-테스트-Unit-Test"><a href="#단위-테스트-Unit-Test" class="headerlink" title="단위 테스트 (Unit Test)"></a>단위 테스트 (Unit Test)</h3><p>개발자는 자신이 만든 모든 s/w를 테스트할 수 있어야지 되고, 그 테스트한 결과로서 자신의 s/w의 품질을 증명할 수 있어야지 됩니다. “내가 하면 되었는데.”, “어제는 되었는데.” 식의 이야기는 곤란합니다. in/out이 결정나면 그 in/out에 대한 명확한 테스트를 하고 그 테스트 결과를 보여줄 수 있어야지 됩니다. 또한 s/w의 규모가 크면 클수록 그 코드를 검증할 수 있어야지 됩니다. 이제는 테스트를 돌리기 위해서 개발을 한다. 라는 말이 나올 정도로 테스트는 일반화된 기술입니다. 자동화된 테스트를 구성하는 능력은 반드시 필요합니다.</p>
<h3 id="Infrastructure-Cloud-Docker-env"><a href="#Infrastructure-Cloud-Docker-env" class="headerlink" title="Infrastructure (Cloud, Docker env)"></a>Infrastructure (Cloud, Docker env)</h3><p>이제는 환경을 제공하는 Cloud를 기반으로 하여 개발 및 서비스가 진행되어가는 시대입니다. Cloud, Docker를 기반으로 하는 환경에서는 역시 이 환경에 대한 이해가 반드시 필요합니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>웹어플리케이션은 지난 20여년동안 눈부시게 발전한 분야입니다. 여러 패러다임들의 변화가 끊임없이 있었습니다. 지금 한국에서 가장 주가 되어 있는 <code>Java</code>를 기준으로 Application 개발 방법에 대해서 한번 같이 알아보도록 하겠습니다.</p>
<p>마지막으로… 제가 Java를 해야지 된다고 이야기를 했지만, 현 2018년의 server-side programing language의 현 사용률은 다음과 같습니다. 국내는 자료 못찾았습니다.</p>
<p><img src="/images/01/flow.png" alt=""></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study/">study</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 ykyoon
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>