<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>05-04.SampleApplication(4) | Programming is Fun | Still waters run deep. When the well&#39;s dry, we know the worth of water.</title>

  
  <meta name="author" content="ykyoon">
  

  
  <meta name="description" content="SampleApplication(4) - TemplateCallback pattern코드 정리 - 객체간의 중복 코드 정리지금까지 우리는 books라는 한개의 table에 CRUD action을 진행해왔습니다. 그렇지만, 개발에서는 한개의 Table만에 CRUD를 하는">
  

  
  
  <meta name="keywords" content="study, java, refactoring">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="05-04.SampleApplication(4)"/>

  <meta property="og:site_name" content="Programming is Fun"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Programming is Fun" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Programming is Fun</a>
    </h1>
    <p class="site-description">Still waters run deep. When the well&#39;s dry, we know the worth of water.</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>05-04.SampleApplication(4)</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/02/05/05-04-sample-app/" rel="bookmark">
        <time class="entry-date published" datetime="2018-02-04T23:58:40.000Z">
          2018-02-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="SampleApplication-4-TemplateCallback-pattern"><a href="#SampleApplication-4-TemplateCallback-pattern" class="headerlink" title="SampleApplication(4) - TemplateCallback pattern"></a>SampleApplication(4) - TemplateCallback pattern</h1><h2 id="코드-정리-객체간의-중복-코드-정리"><a href="#코드-정리-객체간의-중복-코드-정리" class="headerlink" title="코드 정리 - 객체간의 중복 코드 정리"></a>코드 정리 - 객체간의 중복 코드 정리</h2><p>지금까지 우리는 books라는 한개의 table에 CRUD action을 진행해왔습니다. 그렇지만, 개발에서는 한개의 Table만에 CRUD를 하는 경우보다, 한 Action에 대하여 여러개의 Table을 CRUD 하게 되는 것이 일반적입니다.</p>
<p>그래서, 이 두개의 개념을 나누게 되는데요.<br>하나의 Action이라는 것은 Business Logic이라고 할 수 있고, 한 Table에 대한 CRUD는 DB에 종속적인 작업이라고 할 수 있습니다.<br>전자를 일반적으로 Service라고 지칭하고, 후자를 DAO (Data Access Object)라고 지칭하는 것이 일반적입니다. 그리고, DB를 통해서 처리되는 Table 단위 또는 Query 단위의 Object들을 Entity(or model)라고 명명합니다.</p>
<p>이와 같은 이름으로 package로 나누게 되는 것이 일반적입니다. dao, entities, service package를 나누것과 같이 이런 식으로 나눠주는 것이 좋습니다.</p>
<p>1개의 Service는 여러개의 DAO를 가지고 있고, DAO를 이용한 BL을 서술하는 것이 일반적입니다. DAO는 최대한 단순하게 Table에 대한 Query들로 구성이 되고, 그 Query를 통해서 결과를 얻어내는 수단으로 주로 사용됩니다. bookstore에 Business Logic(BL)을 추가하기 전에 book의 상태를 서술할수 있는 property와 현재 책을 빌려간 사용자의 정보를 저장할 수 있는 Column을 두개 추가하고, users table을 추가해서 Dao를 좀더 구성해보도록 하겠습니다.</p>
<p>변경된 table의 구조가 반영된 것으로 docker에 새로운 image를 올려뒀습니다. 기존 container를 삭제시키고, 새로운 docker container를 실행시켜주세요.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">4306</span>:<span class="number">3306</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">94</span>.<span class="number">18</span>:<span class="number">15000</span>/study-container:<span class="number">003</span> mysqld_safe</span><br></pre></td></tr></table></figure>
<p>새로운 Docker Image안에 들어있는 db의 table 구조는 다음과 같습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------+</span><br><span class="line">| Tables_in_bookstore |</span><br><span class="line">+---------------------+</span><br><span class="line">| books               |</span><br><span class="line">| histories           |</span><br><span class="line">| users               |</span><br><span class="line">+---------------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; describe books;</span><br><span class="line">+-------------+--------------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| Field       | <span class="built_in">Type</span>         | Null | Key | Default           | Extra                       |</span><br><span class="line">+-------------+--------------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| id          | int(<span class="number">11</span>)      | NO   | PRI | NULL              | auto_increment              |</span><br><span class="line">| name        | varchar(<span class="number">255</span>) | NO   |     | NULL              |                             |</span><br><span class="line">| author      | varchar(<span class="number">50</span>)  | NO   |     | NULL              |                             |</span><br><span class="line">| publishDate | timestamp    | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</span><br><span class="line">| comment     | varchar(<span class="number">255</span>) | YES  |     | NULL              |                             |</span><br><span class="line">| status      | int(<span class="number">11</span>)      | NO   |     | NULL              |                             |</span><br><span class="line">| rentUserId  | int(<span class="number">11</span>)      | YES  | MUL | NULL              |                             |</span><br><span class="line">+-------------+--------------+------+-----+-------------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; describe users;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | <span class="built_in">Type</span>        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(<span class="number">11</span>)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(<span class="number">50</span>) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(<span class="number">12</span>) | NO   |     | NULL    |                |</span><br><span class="line">| point    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">| level    | int(<span class="number">11</span>)     | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; describe histories;</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| Field      | <span class="built_in">Type</span>      | Null | Key | Default           | Extra                       |</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line">| id         | int(<span class="number">11</span>)   | NO   | PRI | NULL              | auto_increment              |</span><br><span class="line">| userId     | int(<span class="number">11</span>)   | NO   | MUL | NULL              |                             |</span><br><span class="line">| bookId     | int(<span class="number">11</span>)   | NO   | MUL | NULL              |                             |</span><br><span class="line">| actionType | int(<span class="number">11</span>)   | NO   |     | NULL              |                             |</span><br><span class="line">| insertDate | timestamp | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</span><br><span class="line">+------------+-----------+------+-----+-------------------+-----------------------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</span><br></pre></td></tr></table></figure>
<p>위 <code>Service</code>와 <code>DAO</code>에 대한 정의를 보면 지금까지 작성된 <code>BookService</code>는 <code>DAO</code>의 성격이 더 강한 것을 알 수 있습니다. 그렇다면 package에 대한 전체적인 변경을 해보도록 하겠습니다.</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── dao</span><br><span class="line">├── entity</span><br><span class="line">└── service</span><br></pre></td></tr></table></figure>
<p>이 구조는 <code>Business Logic</code>을 다루는 package의 일반적인 구조가 될 수 있습니다. 추후에 <code>WebApplication</code>에서 package에 대한 구조를 좀 더 깊게 다뤄보도록 하겠습니다.</p>
<p>그리고 3개의 Table에 해당되는 <code>DAO</code>인 <code>BookDao</code>, <code>UserDao</code>, <code>HistoryDao</code>를 추가합니다. 그리고, 각 <code>Dao</code>에서 해당되는 <code>Entity</code>들을 모두 추가하면 일단 기본 포멧은 꾸며질 수 있게 됩니다.</p>
<h2 id="Entity-or-Model"><a href="#Entity-or-Model" class="headerlink" title="Entity (or Model)"></a>Entity (or Model)</h2><p>Table 단위의 접근 객체를 의미합니다. 이는 DAO에서 처리하는 객체 단위가 될 수 있습니다. 조금 더 깊은 내용들은 <code>ORM(Oriented Relation Model)</code>에서 좀 더 깊게 다루도록 하겠습니다.</p>
<p>기존 Book의 경우, <code>status</code>와 <code>rentUserId</code>가 추가되었습니다. 이를 단순히 <code>int</code> 값으로 처리가 가능합니다. 그런데, 이렇게 int 값으로 처리를 하게 되면 int 값에 대한 내용 서술이 되지 않습니다. 이런 경우 이 값을 <code>enum</code> 형태로 만들어서 처리해주면 좋습니다. 이 부분에 대해서는 논쟁이 조금 있습니다. 상태의 경우 <code>code table</code>을 통해서 처리가 되는 것이 일반적입니다. 이렇게 <code>enum</code>을 이용할 때의 장점은 무엇이 있을까요? 이 부분에 대해서는 각 개발자들이 한번 공부를 해보는 것이 어떨까 생각을 하고 있습니다. 약간의 논쟁이 되는 부분중 하나라고 생각합니다. (<a href="http://woowabros.github.io/tools/2017/07/10/java-enum-uses.html" target="_blank" rel="noopener">http://woowabros.github.io/tools/2017/07/10/java-enum-uses.html</a>)</p>
<p>BookStatus를 enum으로 정의하면 다음 코드로 표현이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BookStatus &#123;</span><br><span class="line">    CanRent(<span class="number">0</span>),</span><br><span class="line">    RentNow(<span class="number">1</span>),</span><br><span class="line">    Missing(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    BookStatus(<span class="keyword">int</span> value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BookStatus <span class="title">parse</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(value) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span> : <span class="keyword">return</span> CanRent;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> : <span class="keyword">return</span> RentNow;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span> : <span class="keyword">return</span> Missing;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BookStatus</code>를 반영한 <code>Book</code> 코드는 다음과 같이 구성됩니다. (lombok을 찬양합시다.)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Date publishDate;</span><br><span class="line">    <span class="keyword">private</span> BookStatus bookStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>User</code>, <code>History</code>에 대한 <code>Entity</code>를 구성해보도록 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> point;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">History</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> HistoryActionType actionType;</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DAO의-기능"><a href="#DAO의-기능" class="headerlink" title="DAO의 기능"></a>DAO의 기능</h2><p><code>DAO</code>는 일반적으로 Data에 접근하고 처리할 수 있는 기능들을 제공합니다. 이는 Table의 CRUD기능을 의미하게 됩니다. 이제 일반적인 CRUD의 경우, 다음 Code로 정의가 가능할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookStoreDao</span>&lt;<span class="title">T</span>, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function">T <span class="title">getById</span><span class="params">(K id)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">update</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이렇게 <code>interface</code>를 제공하게 되면, 객체들을 만들때 어떤 객체들을 다 만들어줘야지 되는지를 좀 더 명확히 해줄 수 있습니다. 그리고 구현이 되는 객체가 어떤 일을 할 수 있는지에 대한 선언을 해줄 수 있습니다. 이제 구현되는 <code>BookDao</code>를 한번 구현해 보도록 하겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select count(*) from books"</span>);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        rs.next();</span><br><span class="line"></span><br><span class="line">        Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"delete from books"</span>);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select id, name, author, status, rentUserId, comment, publishDate from books"</span>);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            Book book = <span class="keyword">new</span> Book();</span><br><span class="line">            book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">            book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">            book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">            java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">            Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">            book.setRentUserId(rentUserId);</span><br><span class="line">            book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">            books.add(book);</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"select id, name, author, publishDate, comment, status, rentUserId from books where id=?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, id);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">        Book book = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            book = <span class="keyword">new</span> Book();</span><br><span class="line">            book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">            book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">            book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">            java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setPublishDate(date);</span><br><span class="line">            book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">            Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">            book.setRentUserId(rentUserId);</span><br><span class="line">            book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>);</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(<span class="string">"delete from books where id = ?"</span>);</span><br><span class="line">        st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">        st.execute();</span><br><span class="line"></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 여기서 중복 코드를 제거해보는 절차를 진행해보고자 합니다. 먼저 계속해서나오는 <code>ResultSet</code>을 <code>Book</code>으로 변환시키는 코드가 계속해서 중복되고 있는 것을 볼 수 있습니다.</p>
<p>이를 따로 뽑아내면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Book <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Book book = <span class="keyword">new</span> Book();</span><br><span class="line">    book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">    book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">    book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">    java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">    book.setPublishDate(date);</span><br><span class="line">    book.setPublishDate(date);</span><br><span class="line">    book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">    Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">    book.setRentUserId(rentUserId);</span><br><span class="line">    book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> book;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DB에서 Query를 실행시키는 코드는 두가지의 패턴을 가지고 있습니다. <code>add</code>, <code>update</code>, <code>delete</code>와 같이 query를 실행시키는 코드와 <code>getById</code>, <code>getAll</code>과 같이 query의 실행 후 그 결과(<code>ResultSet</code>)를 이용해서 객체를 만들어주는 코드로 나눌 수 있습니다.</p>
<h3 id="Query를-단순-실행하는-코드"><a href="#Query를-단순-실행하는-코드" class="headerlink" title="Query를 단순 실행하는 코드"></a>Query를 단순 실행하는 코드</h3><p>DB에서 값을 처리하는 과정은 다음과 같습니다.  <code>Connection</code>을 얻어내고 <code>PreparedStatement</code>를 구성하고, <code>PreparedStatement</code>를 <code>Close</code>시켜주고, <code>Connection</code>을 <code>Close</code>시켜주게 됩니다. 이는 정해진 패턴이고 계속되는 중복 코드를 가지고 오게 됩니다.</p>
<p>이제 이 코드는 다음과 같이 보여줄 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementProcess</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Connection conn = connectionFactory.getConnection();</span><br><span class="line">    PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">    process.doProcess(st);</span><br><span class="line">    st.execute();</span><br><span class="line">    st.close();</span><br><span class="line">    conn.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이렇게 수정하면 다음 코드들은 다음과 같이 수정이 가능합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">        st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">        java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">        st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">        st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">        st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">        st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    executeProcess(<span class="string">"delete from books where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">        st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기존 코드와 비교해서 어느정도 코드가 줄어드는지 확인해보시길 바랍니다. 이렇게 시작 Process와 종료 Process가 동일한데 중간 Action 만이 변경되는 코드를 위와 같이 구성하는 패턴을 <code>Template Pattern</code>이라고 합니다.</p>
<h3 id="Query의-실행결과를-이용하는-경우"><a href="#Query의-실행결과를-이용하는-경우" class="headerlink" title="Query의 실행결과를 이용하는 경우"></a>Query의 실행결과를 이용하는 경우</h3><p>Query를 단순 실행하는 패턴과 거의 동일합니다. 패턴의 코드는 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Connection conn = connectionFactory.getConnection();</span><br><span class="line">    PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">    process.doProcess(st);</span><br><span class="line"></span><br><span class="line">    ResultSet rs = st.executeQuery();</span><br><span class="line"></span><br><span class="line">    T result = process.convertFromResultSet(rs);</span><br><span class="line"></span><br><span class="line">    rs.close();</span><br><span class="line">    st.close();</span><br><span class="line">    conn.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>적용된 Pattern을 적용하면 <code>BookDao</code>는 다음과 같이 변경할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> <span class="keyword">implements</span> <span class="title">BookStoreDao</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select count(*) from books"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> count.intValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"delete from books"</span>, (st) -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, status, rentUserId, comment, publishDate from books"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;List&lt;Book&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    books.add(convertBookFromResultSet(rs));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> books;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getById</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sql = <span class="string">"select id, name, author, publishDate, comment, status, rentUserId from books where id=?"</span>;</span><br><span class="line">        <span class="keyword">return</span> executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Book&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                st.setInt(<span class="number">1</span>, id);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Book <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Book book = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                    book = convertBookFromResultSet(rs);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> book;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"update books set name = ?, author = ?, publishDate = ?, comment = ?, status = ?, rentUserId =? where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">            st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">            st.setDate(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime()));</span><br><span class="line">            st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">            st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">            st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">            st.setInt(<span class="number">7</span>, book.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Book book)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"insert books(name, author, publishDate, comment, status, rentUserId) values(?, ?, ?, ?, ?, ?)"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, book.getName());</span><br><span class="line">            st.setString(<span class="number">2</span>, book.getAuthor());</span><br><span class="line">            java.sql.Date sqlDate = <span class="keyword">new</span> java.sql.Date(book.getPublishDate().getTime());</span><br><span class="line">            st.setDate(<span class="number">3</span>, sqlDate);</span><br><span class="line">            st.setString(<span class="number">4</span>, book.getComment());</span><br><span class="line">            st.setInt(<span class="number">5</span>, book.getBookStatus().value());</span><br><span class="line">            st.setObject(<span class="number">6</span>, book.getRentUserId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Book entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        executeProcess(<span class="string">"delete from books where id = ?"</span>, (st) -&gt; &#123;</span><br><span class="line">            st.setInt(<span class="number">1</span>, entity.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementProcess</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">InnerPreparedStatementAndResultSetProcess</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">        <span class="function">T <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        T result = process.convertFromResultSet(rs);</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Book <span class="title">convertBookFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">        book.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">        book.setAuthor(rs.getString(<span class="string">"author"</span>));</span><br><span class="line">        java.util.Date date = <span class="keyword">new</span> java.util.Date(rs.getDate(<span class="string">"publishDate"</span>).getTime());</span><br><span class="line">        book.setPublishDate(date);</span><br><span class="line">        book.setPublishDate(date);</span><br><span class="line">        book.setBookStatus(BookStatus.parse(rs.getInt(<span class="string">"status"</span>)));</span><br><span class="line">        Integer rentUserId = (Integer) rs.getObject(<span class="string">"rentUserId"</span>);</span><br><span class="line">        book.setRentUserId(rentUserId);</span><br><span class="line">        book.setComment(rs.getString(<span class="string">"comment"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>여기서 반영된 코드는 이제 <code>Query</code>를 실행시키는 역활만을 담당하게 됩니다. 이제 좀더 <code>OOP</code>적인 코드가 될 수 있게 됩니다.<br><code>DAO</code>는 DB에 <code>CRUD</code>를 행합니다. <code>DAO</code>에서 <code>CRUD</code>를 처리할 때, 이제 DB에 대한 연결, Query의 전달만을 처리하는 것으로 역활을 담당하면 이 역활을 타 DAO(UserDao, HistoryDao)가 같이 사용할 수 있게 됩니다.</p>
<h2 id="Refactoring-SQL-실행부"><a href="#Refactoring-SQL-실행부" class="headerlink" title="Refactoring SQL 실행부"></a>Refactoring SQL 실행부</h2><p>이제 DB에서의 실행부를 분리해보도록 하겠습니다. <code>SqlExecutor</code>라는 객체로 만들어서 따로 뽑아주고, 그에 대한 interface 역시 정리해줍니다. 그럼 코드는 다음과 같은 형태가 될 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlExecutor</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementAndResultSetProcess&lt;T&gt; process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        T result = process.convertFromResultSet(rs);</span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeProcess</span><span class="params">(String sql, InnerPreparedStatementProcess process)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection conn = connectionFactory.getConnection();</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        process.doProcess(st);</span><br><span class="line">        st.execute();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>DAO</code>에서는 <code>ConnectionFactory</code>가 아닌 <code>SqlExecutor</code>를 이용해서 처리하도록 변경합니다. 생성자가 다음과 같이 변경될 필요가 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SqlExecutor sqlExecutor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BookDao</span><span class="params">(SqlExecutor sqlExecutor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.sqlExecutor = sqlExecutor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String sql = <span class="string">"select count(*) from books"</span>;</span><br><span class="line">    <span class="keyword">return</span> sqlExecutor.executeProcess(sql, <span class="keyword">new</span> InnerPreparedStatementAndResultSetProcess&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(PreparedStatement st)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">convertFromResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            Long count = rs.getLong(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> count.intValue();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 구성된 <code>BookDao</code>, <code>UserDao</code>, <code>HistoryDao</code>를 구성하는 <code>applicaiton-context.xml</code>은 다음과 같습니다. <code>@Configuration</code>도 같이 첨부합니다. 참고해보시길 바랍니다.</p>
<h2 id="코드-정리-Exception의-처리"><a href="#코드-정리-Exception의-처리" class="headerlink" title="코드 정리 - Exception의 처리"></a>코드 정리 - Exception의 처리</h2><p>지금까지 보시면 SqlExecutor를 이용한 코드의 간결화를 해온것을 알 수 있습니다.</p>
<p>마지막으로, 지금 저희 코드에 중복이 되는 코드를 찾아보도록 합시다.<br>딱히 문제가 특출나게 보이지는 않습니다. 지금까지 상당한 refactoring을 통해서 변경시킨 코드에 문제가 쉽게 보이면 그것 역시 문제가 될 수 있습니다.</p>
<p>지금 모든 코드에 나타나 있는 Exception이 선언되어 있습니다. DB access 코드에 원래 일괄적으로 들어가 있어야할 Exception들은 다음과 같습니다.</p>
<ul>
<li>InstantiationException : Class.forName 에서 객체의 이름이 아닌, interface의 이름이 들어간 경우에 발생하는 에러.</li>
<li>IllegalAccessException : Db Connection시, 권한이 없거나 id/password가 틀린 경우에 발생하는 에러</li>
<li>ClassNotFoundException : Class.forName 을 이용, DB Connection 객체를 생성할 때 객체의 이름이 틀린 경우에 발생하는 에러</li>
<li>SQLException : SQL query가 잘못된 Exception입니다.</li>
</ul>
<p>Java는 2개의 Exception type을 가지고 있습니다. checked exception과 Runtime Exception인데요. checked exception의 경우, 이 exception이 발생하는 경우에는 반드시 exception을 처리해줘야지 됩니다. 또는 상위 method로 throw를 해줘야지 됩니다.</p>
<p>Runtime exception은 상위에서 처리를 안해줘도 되고요. 대표적인 것은 NullPointerException, UnsupportedOperationException, IllegalArgumentException 등이 있습니다.</p>
<p>이 부분은 매우 중요한 개념입니다. java에서의 exception은 사용자가 처리해줘야지 될 것(체크 해야지 될 exception)과 Runtime 시(실행시에) 확인되어야지 될 것들로 나뉘게 됩니다. exception에 대하여 보다더 확실한 처리를 해주길 바란 java의 설계 원칙이지만, 근간에는 비판이 좀 많은 부분이기도 합니다. java의 exception에 대한 정리를 한번 해주시는 것이 필요합니다.</p>
<p>그럼, 지금 저희가 사용한 코드중에서 getConnection() method를 확인해보겠습니다. Exception은 원래 이렇게 처리가 되어야지 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">    Connection conn = DriverManager.getConnection (<span class="keyword">this</span>.connectionString, <span class="keyword">this</span>.username, <span class="keyword">this</span>.password);</span><br><span class="line">    <span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 method는 이 4개의 exception을 반드시 처리하도록 되어 있습니다. 또는 이 4개의 exception을 사용한 method로 던져줘서 상위 method에서 처리하도록 되어 있는데요. DB 접속과 SQL query가 잘못된 경우에 대한 exception 처리는 과연 할 수 있을까요? 이 Exception은 처리할 수 없는 Exception을 넘겨줘서 되는 것이 아닌가. 라는 생각을 할 수 있습니다. 잘 보면 대부분의 DB 접속시에 나오는 대부분의 Exception은 처리가 불가능한 Exception이라고 할 수 있습니다. 에러의 내용은 도움이 될 수 있지만, 이 에러가 발생했을 때 어떠한 처리를 하지를 못하는 경우가 대다수라는거지요.</p>
<p>어떤 방법으로 Exception을 처리할지는 이 코드를 사용하는 곳에서 어떻게 할지를 정해보는것이 좋습니다. 예를 들어, <code>SqlExecutor</code>에서 발생하는 에러를 모두 <code>DaoException</code>으로 만들어서 처리하고, log를 남기는 것도 방법입니다.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><ul>
<li>객체간의 코드중복은 최대한 줄여야지 됩니다. 이를 남겨두면 결국은 코드의 기술부채로서 남습니다.</li>
<li>코드중복을 없애는 방법중에서 유용하지만, 어렵지만 좋은 Pattern이 Template Pattern을 이용해서 처리하는 것입니다.</li>
<li>Java의 Exception은 Check-Exception과 Runtime-Exception으로 구분되고 있습니다. java나 library들에서 제공되는 객체들의 Check-Exception은 남겨두는 것이 좋지만, BL Logic에서의 Check-Exception은 독이 되는 것이 대부분입니다. Runtime-Exception 으로 변경시켜서 처리하는 것이 좋습니다.</li>
</ul>
<p>다음은 지금까지 구성된 코드를 <code>Spring</code>으로 구성되는 BookStore를 만나보실 수 있을 것입니다.</p>
<p>ps: UserDao, HistoryDao 코드를 모두 만들어서 와주시길 바랍니다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/study-java-refactoring/">study, java, refactoring</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 ykyoon
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>